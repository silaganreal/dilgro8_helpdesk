import{u as z,r as l,b as F,j as e,H as Ee,L as Ie}from"./app-C77T0p46.js";import{B as h}from"./button-siy9X3EL.js";import{A as _e}from"./app-layout-CjqcdU3y.js";import{D as H,a as q,b as k,c as T,d as le}from"./dialog-DauyDvCJ.js";import{T as De}from"./textarea-B_7uSHes.js";import{L as o}from"./label-CLluktiz.js";import{S as u,a as f,b as g,c as x,f as n}from"./select-CC7vqOKU.js";import{s as V,E as Me,F as Le}from"./notif-DXFnojdJ.js";import Ae from"./ProcessSummaryReport-DP1wX1PI.js";import"./x-CFGDsH-c.js";import"./index-DUwK2dLK.js";import"./index-CrHIwck-.js";import"./index-Cah93LnR.js";import"./index-B22TB8tb.js";import"./createLucideIcon-BO6X6aoD.js";import"./index-2bHg7lHK.js";import"./index-D7sO1ybx.js";import"./app-logo-icon-ChCjUOJ_.js";import"./index-E-BiPGT6.js";const Re=[{title:"Dashboard",href:"/dashboard"}],lt=()=>{const{auth:i}=z().props,[$,re]=l.useState(null),[U,ie]=l.useState(null),{logs:E,filters:B}=z().props,[p,G]=l.useState(E),ne=p?.meta?.current_page??1,oe=p?.meta?.per_page??10,{superadmins:j=[]}=z().props,[J,I]=l.useState(!1),[de,b]=l.useState(!1),[W,_]=l.useState(null),[D,C]=l.useState(""),[M,v]=l.useState(""),[ce,w]=l.useState(!1),he=j.find(s=>String(s.id)===D)?.css_link??"#",[m,me]=l.useState(B.staff??"all"),[L,ue]=l.useState(B.status??"all"),[N,fe]=l.useState(""),[S,ge]=l.useState(""),xe=m!=="all"||L!=="all"||N!==""||S!=="",K=p.data.filter(s=>{const t=m==="all"||s.it_staff===m,r=new Date(s.finished_date).getTime(),R=!N||r>=new Date(N).setHours(0,0,0,0),O=!S||r<=new Date(S).setHours(23,59,59,999);return t&&R&&O}),[pe,A]=l.useState(!1),[je,be]=l.useState("all"),[Ce,ve]=l.useState("all"),[Y,we]=l.useState(""),[Q,Ne]=l.useState("");function X(s){F.get(route("dashboard"),{staff:s.staff!=="all"?s.staff:void 0,status:s.status!=="all"?s.status:void 0},{preserveState:!0,preserveScroll:!0,replace:!0})}function Se(){const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/deploy-commands-local":"/deploy-commands";fetch(t).then(r=>r.json()).then(r=>{alert(r.message)}).catch(()=>{alert("Deployment failed.")})}const ye=async()=>{const s=new Me.Workbook,t=s.addWorksheet("TA Monitoring Logsheet");t.columns=[{width:5},{width:25},{width:12},{width:12},{width:20},{width:20},{width:20},{width:25},{width:20},{width:15},{width:15},{width:15},{width:15},{width:20},{width:15}];const r=await fetch("/dilg-logo.png").then(a=>a.blob()).then(a=>new Promise(d=>{const c=new FileReader;c.onload=()=>d(c.result),c.readAsArrayBuffer(a)})),R=s.addImage({buffer:r,extension:"png"});t.addImage(R,{tl:{col:1,row:0},ext:{width:85,height:85}}),t.mergeCells("M1:O1"),t.getCell("M1").value="Document Code",t.getCell("M1").alignment={horizontal:"left",vertical:"middle"},t.getCell("M1").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("M1").font={color:{argb:"FFFFFF"},bold:!0},t.mergeCells("M2:O2"),t.getCell("M2").value="FM-QP-DILG-ISTMS-17-02",t.getCell("M2").alignment={horizontal:"center",vertical:"middle"},t.getCell("M2").font={bold:!0},t.getCell("M3").value="Rev. No.",t.getCell("M3").alignment={horizontal:"center",vertical:"top"},t.getCell("M3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("M3").font={color:{argb:"FFFFFF"},bold:!0},t.getCell("N3").value="Eff. Date",t.getCell("N3").alignment={horizontal:"center",vertical:"top"},t.getCell("N3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("N3").font={color:{argb:"FFFFFF"},bold:!0},t.getCell("O3").value="Page",t.getCell("O3").alignment={horizontal:"center",vertical:"top"},t.getCell("O3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("O3").font={color:{argb:"FFFFFF"},bold:!0},t.mergeCells("C2:G2"),t.getCell("C2").value="Department of the Interior and Local Government",t.getCell("C2").alignment={horizontal:"left",vertical:"middle"},t.getCell("C2").font={size:14},t.getRow(2).height=18,t.mergeCells("C3:H4"),t.getCell("C3").value="ICT Technical Assistance Monitoring Logsheet",t.getCell("C3").alignment={horizontal:"left",vertical:"top"},t.getCell("C3").font={size:23,bold:!0},t.getRow(3).height=25,t.mergeCells("A6:O6"),t.getCell("A6").value="PERIOD:",t.getCell("A6").alignment={horizontal:"left",vertical:"middle"};const O={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};["A6","B6","C6","D6","E6","F6","G6","H6","I6","J6","K6","L6","M6","N6","O6","M2","N2","O2","M4","N4","O4"].forEach(a=>{t.getCell(a).border=O}),t.addRow([]),t.mergeCells("A7:A8"),t.getCell("A7").value="NO.",t.mergeCells("B7:B8"),t.getCell("B7").value="ICT TECHNICAL ASSISTANCE REFERENCE NO.",t.mergeCells("C7:D7"),t.getCell("C7").value="RECEIVED",t.getCell("C8").value="DATE",t.getCell("D8").value="TIME",t.mergeCells("E7:E8"),t.getCell("E7").value="NAME OF THE END-USER",t.mergeCells("F7:G8"),t.getCell("F7").value="OFFICE/SERVICE/BUREAU/DIVISION/SECTION/UNIT",t.getCell("F7").alignment={horizontal:"center",vertical:"middle",wrapText:!0},t.getCell("F7").font={bold:!0},t.mergeCells("H7:H8"),t.getCell("H7").value="ISSUE/CONCERN",t.mergeCells("I7:I8"),t.getCell("I7").value="TECHNICAL PERSONNEL ASSIGNED",t.mergeCells("J7:K7"),t.getCell("J7").value="AGREED TIMELINE (if any)",t.getCell("J8").value="DATE",t.getCell("K8").value="TIME",t.mergeCells("L7:M7"),t.getCell("L7").value="COMPLETED",t.getCell("L8").value="DATE",t.getCell("M8").value="TIME",t.mergeCells("N7:N8"),t.getCell("N7").value="TOTAL PROCESSING TIME",t.mergeCells("O7:O8"),t.getCell("O7").value="OVERALL QUALITY RATING",t.getRow(7).height=30,t.getRow(8).height=25;for(let a=7;a<=8;a++)t.getRow(a).eachCell(d=>{d.font={bold:!0},d.alignment={horizontal:"center",vertical:"middle",wrapText:!0},d.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});const Fe=new URLSearchParams({staff:je,status:Ce,date_from:Y??"",date_to:Q??""}).toString();(await(await fetch(`/tarf-logs/export-tamls?${Fe}`)).json()).forEach((a,d)=>{const c=new Date(a.created_at);let Z="-";if(a.finished_date&&a.finished_time){const te=new Date(`${a.finished_date} ${a.finished_time}`).getTime()-c.getTime(),se=Math.floor(te/(1e3*60*60)),ae=Math.floor(te%(1e3*60*60)/(1e3*60));Z=se>0?`${se}hrs ${ae}mins`:`${ae}mins`}const Te=(a.fname??"")+" "+(a.lname??""),ee=t.addRow([d+1,a.reference_no??"-",c.toLocaleDateString(),c.toLocaleTimeString(),Te??"-","-",a.sec_div_unit??"-",a.problem_description??"-",a.it_fname??"-",a.agreed_date??"-",a.agreed_time??"-",a.finished_date??"-",a.finished_time??"-",Z,"4"]);ee.eachCell(P=>{P.alignment={vertical:"middle",horizontal:"center"},P.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});const y=ee.number;t.mergeCells(`F${y}:G${y}`),t.getCell(`F${y}`).value=a.sec_div_unit&&a.sec_div_unit!==""?a.sec_div_unit:"-",t.getCell(`F${y}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const ke=await s.xlsx.writeBuffer();Le.saveAs(new Blob([ke]),"RICTU_TA-Monitoring-Logsheet.xlsx")};return l.useEffect(()=>{if(i?.user?.role!=="admin"&&i?.user?.role!=="superadmin")return;const s=setInterval(()=>{fetch("/check-new-requests").then(t=>t.json()).then(t=>{const r=t.latest_id;r&&r!==$&&(re(r),V(i,"New Support Request","A user has submitted a new request."),F.reload({only:["logs"]}))}).catch(()=>{})},5e3);return()=>clearInterval(s)},[$]),l.useEffect(()=>{if(i?.user?.role!=="admin"&&i?.user?.role!=="superadmin")return;const s=setInterval(()=>{fetch("/check-finished-requests").then(t=>t.json()).then(t=>{t.updated_at&&t.updated_at!==U&&(ie(t.updated_at),V(i,"Request Completed","A user has marked a request as finished."),F.reload({only:["logs"]}))}).catch(()=>{})},5e3);return()=>clearInterval(s)},[U]),l.useEffect(()=>{G(E)},[E]),e.jsxs(_e,{breadcrumbs:Re,children:[e.jsx(Ee,{title:"Dashboard"}),e.jsxs("div",{className:"flex m-4 gap-2",children:[e.jsx(h,{asChild:!0,children:e.jsx(Ie,{href:"/support-form",children:"Contact Support"})}),(i?.user?.role==="admin"||i?.user?.role==="superadmin")&&e.jsx(h,{onClick:Se,className:"cursor-pointer",children:"Optimize Routes"})]}),e.jsx(H,{open:J,onOpenChange:()=>{},children:e.jsxs(q,{className:"flex flex-col items-center justify-center gap-4 py-10",children:[e.jsx(k,{children:e.jsx(T,{})}),e.jsxs("svg",{className:"animate-spin h-8 w-8 text-primary",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Processing your request..."})]})}),e.jsx(H,{open:de,onOpenChange:s=>{s?b(!0):(b(!1),w(!1),_(null),C(""),v(""))},children:e.jsx(q,{className:"sm:max-w-md",children:ce?e.jsxs("div",{className:"text-center space-y-4 py-6",children:[e.jsx(k,{className:"flex items-center justify-center text-xl font-semibold",children:e.jsx(T,{children:"Thank you!"})}),e.jsxs("p",{children:["Thanks for completing the request. Please complete answering the",e.jsx("b",{children:" Client Satisfaction Measure System"})," as part of our report. We appreciate your feedback!"]}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("a",{href:he,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-4 py-2 rounded-md border bg-blue-600 text-white",children:"Go to CSMS Form"}),e.jsx(h,{variant:"outline",onClick:()=>{w(!1),b(!1),C("")},children:"Close"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{children:e.jsx(T,{children:"Update Status"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"it_staff",children:"Select IT Staff"}),e.jsxs(u,{value:D,onValueChange:C,children:[e.jsx(f,{id:"it_staff",children:e.jsx(g,{placeholder:"Select IT Staff"})}),e.jsx(x,{children:j.map(s=>e.jsxs(n,{value:String(s.id),children:[s.fname," ",s.lname]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"remarks",children:"Remarks"}),e.jsx(De,{id:"remarks",placeholder:"Enter remarks...",value:M,onChange:s=>v(s.target.value)})]})]}),e.jsx(le,{children:e.jsx(h,{disabled:J,onClick:()=>{if(!W)return;const s=W;I(!0),F.put(`/tarf-logs/${s}/status`,{status:"finished",it_staff:D,remarks:M},{onSuccess:()=>{I(!1),G(t=>({...t,data:t.data.map(r=>r.id===s?{...r,status:"finished",remarks:M,finished_date:new Date().toISOString().split("T")[0],finished_time:new Date().toLocaleTimeString()}:r)})),w(!0),_(null),v("")},onError:()=>{I(!1),V(i,"Update failed","Could not update status. Try again.")}})},children:"Submit"})})]})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex flex-3 flex-wrap justify-start gap-10",children:[e.jsx("div",{className:"flex items-end mb-1",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Support Requests"})}),e.jsxs("div",{className:"flex flex-3 flex-wrap justify-start gap-2",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Filter by IT Staff"}),e.jsxs(u,{value:m,onValueChange:s=>{me(s),X({staff:s,status:L})},children:[e.jsx(f,{className:"dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(g,{placeholder:"Filter by IT Staff"})}),e.jsxs(x,{children:[e.jsx(n,{value:"all",children:"All"}),j.map(s=>e.jsxs(n,{value:String(s.id),children:[s.fname," ",s.lname]},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Filter by Status"}),e.jsxs(u,{value:L,onValueChange:s=>{ue(s),X({staff:m,status:s})},children:[e.jsx(f,{className:"dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(g,{placeholder:"All Status"})}),e.jsxs(x,{children:[e.jsx(n,{value:"all",children:"All"}),e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"finished",children:"Finished"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Filter by Date (From - To)"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"date",className:"w-1/2 dark:bg-gray-800 dark:border-gray-600 dark:text-white border rounded px-2 py-[5px]",value:N,onChange:s=>fe(s.target.value)}),e.jsx("input",{type:"date",className:"w-1/2 dark:bg-gray-800 dark:border-gray-600 dark:text-white border rounded px-2 py-[5px]",value:S,onChange:s=>ge(s.target.value)})]})]})]})]}),e.jsx("div",{className:"flex flex-2 flex-wrap items-end gap-2 justify-end",children:(i?.user?.role==="admin"||i?.user?.role==="superadmin")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center items-center gap-3",children:e.jsx("div",{children:e.jsx(h,{onClick:()=>A(!0),className:"bg-blue-600 hover:bg-blue-700 text-white mt-0 md:mt-5 cursor-pointer",children:"Monitoring Logsheett"})})}),e.jsx(Ae,{})]})})]}),e.jsx("div",{className:"overflow-x-auto border rounded-lg mb-4",children:e.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border",children:"No."}),e.jsx("th",{className:"p-3 border",children:"Sender"}),e.jsx("th",{className:"p-3 border",children:"Request Type"}),e.jsx("th",{className:"p-3 border",children:"Problem Description"}),e.jsx("th",{className:"p-3 border",children:"Uploaded File"}),e.jsx("th",{className:"p-3 border",children:"Request Date"}),e.jsx("th",{className:"p-3 border",children:"IT Staff"}),e.jsx("th",{className:"p-3 border",children:"Finished Date"}),e.jsx("th",{className:"p-3 border",children:"Remarks"}),e.jsx("th",{className:"p-3 border",children:"Action"})]})}),e.jsx("tbody",{children:K.map((s,t)=>e.jsxs("tr",{className:"hover:bg-gray-100 dark:hover:bg-gray-500",children:[e.jsx("td",{className:"p-3 border",children:(ne-1)*oe+t+1}),e.jsx("td",{className:"p-3 border",children:s.fname+" "+s.lname}),e.jsx("td",{className:"p-3 border",children:s.request_type_name}),e.jsx("td",{className:"p-3 border",children:s.problem_description||"-"}),e.jsx("td",{className:"p-3 border",children:s.uploaded_file?e.jsx("a",{href:`/storage/${s.uploaded_file}`,target:"_blank",className:"text-blue-600 underline",children:"View File"}):"-"}),e.jsx("td",{className:"p-3 border",children:s.created_at||"-"}),e.jsx("td",{className:"p-3 border",children:s.it_fname||"-"}),e.jsx("td",{className:"p-3 border",children:(s.finished_date??"-")+" "+(s.finished_time??"-")}),e.jsx("td",{className:"p-3 border",children:s.remarks??"-"}),e.jsx("td",{className:"p-3 border",children:s.status==="pending"?e.jsx(h,{size:"sm",className:"bg-orange-300 hover:bg-orange-400",onClick:()=>{_(s.id),C(s.it_staff||""),v(s.remarks||""),b(!0),w(!1)},children:"Update Status"}):e.jsx("span",{className:"text-green-700 font-semibold text-sm",children:"✔Finished"})})]},s.id))})]})}),xe?e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Showing ",K.length," result(s) — pagination is disabled while filters are active."]}):e.jsx("div",{className:"flex justify-center mt-4",children:p.links.map((s,t)=>e.jsx("button",{disabled:!s.url,className:`px-3 py-1 mx-1 rounded border ${s.active?"bg-blue-600 text-white":"bg-white text-gray-700"}`,dangerouslySetInnerHTML:{__html:s.label},onClick:()=>{s.url&&(window.location.href=s.url)}},t))})]}),e.jsx(H,{open:pe,onOpenChange:A,children:e.jsxs(q,{className:"sm:max-w-md",children:[e.jsx(k,{children:e.jsx(T,{children:"Download Monitoring Logsheet"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Filter by IT Staff"}),e.jsxs(u,{onValueChange:be,defaultValue:"all",children:[e.jsx(f,{className:"bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(g,{placeholder:"All Staff"})}),e.jsxs(x,{children:[e.jsx(n,{value:"all",children:"All"}),j.map(s=>e.jsxs(n,{value:String(s.id),children:[s.fname," ",s.lname]},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Filter by Status"}),e.jsxs(u,{onValueChange:ve,defaultValue:"all",children:[e.jsx(f,{className:"bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(g,{placeholder:"All Status"})}),e.jsxs(x,{children:[e.jsx(n,{value:"all",children:"All"}),e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"finished",children:"Finished"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Date From"}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:Y,onChange:s=>we(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Date To"}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:Q,onChange:s=>Ne(s.target.value)})]})]}),e.jsx(le,{children:e.jsx(h,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{A(!1),ye()},children:"Download Logsheet"})})]})})]})};export{lt as default};
