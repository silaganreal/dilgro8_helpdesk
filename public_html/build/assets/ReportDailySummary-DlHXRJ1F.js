import{u as D,r as h,j as a}from"./app-DGf4tkIF.js";import{s as g,E,F as B}from"./notif-Brxvyi7Z.js";import{B as R}from"./button-1e0LvRcT.js";import{L as p}from"./label-dBvvjuKR.js";import"./index-C8_E6Yb5.js";const T="ICT Technical Assistance Process Summary Logsheet",k="FM-QP-DILG-ISTMS-RO-17-03";function A(){const{auth:m}=D().props,[n,x]=h.useState(""),[l,C]=h.useState(""),[f,w]=h.useState(!1),y=async(t,s)=>{const i=`/reports/daily-summary?${new URLSearchParams({from:t,to:s}).toString()}`,r=await fetch(i,{credentials:"same-origin"});if(!r.ok){const d=await r.text();throw new Error(`Server error: ${r.status} ${d}`)}return await r.json()},b=async t=>{const s=new E.Workbook,e=s.addWorksheet("Summary");e.columns=[{width:20},{width:20}];try{const o=await fetch("/dilg-logo.png");if(o.ok){const d=await o.blob(),c=await new Promise(j=>{const u=new FileReader;u.onload=()=>j(u.result),u.readAsArrayBuffer(d)}),S=s.addImage({buffer:c,extension:"png"});e.addImage(S,{tl:{col:.2,row:0},ext:{width:80,height:80}})}}catch{}e.mergeCells("C1:D1"),e.getCell("C1").value="Document Code",e.getCell("C1").font={bold:!0},e.mergeCells("C2:D2"),e.getCell("C2").value=k,e.getCell("C2").font={bold:!0},e.mergeCells("B3:C3"),e.getCell("B3").value="Department of the Interior and Local Government",e.getCell("B3").font={size:14},e.mergeCells("B4:D5"),e.getCell("B4").value=T,e.getCell("B4").font={size:18,bold:!0},e.addRow([]),e.addRow([]);const i=e.addRow(["Finished Date","No. of Requests"]);i.font={bold:!0},i.eachCell(o=>{o.alignment={vertical:"middle",horizontal:"center"},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),t.forEach(o=>{e.addRow([o.date,o.count]).eachCell(c=>{c.alignment={vertical:"middle",horizontal:"center"},c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})});const r=await s.xlsx.writeBuffer();B.saveAs(new Blob([r]),`ICT_TA_Summary_${n}_to_${l}.xlsx`)},v=async()=>{if(!n||!l){g(m,"Validation","Please choose both From and To dates.");return}w(!0);try{const t=await y(n,l);await b(t),g(m,"Export ready","Summary Excel was downloaded.")}catch(t){console.error(t),g(m,"Export failed",t.message||"Could not generate report.")}finally{w(!1)}};return a.jsx("div",{className:"p-4 border rounded-lg bg-white",children:a.jsxs("div",{className:"flex items-end gap-3",children:[a.jsxs("div",{children:[a.jsx(p,{children:"From"}),a.jsx("input",{type:"date",value:n,onChange:t=>x(t.target.value),className:"border p-2 rounded"})]}),a.jsxs("div",{children:[a.jsx(p,{children:"To"}),a.jsx("input",{type:"date",value:l,onChange:t=>C(t.target.value),className:"border p-2 rounded"})]}),a.jsx("div",{className:"mt-6",children:a.jsx(R,{onClick:v,disabled:f,children:f?"Generating...":"Generate Summary Excel"})})]})})}export{A as default};
