import{K as le,r,S as V,j as e,L as Se,$ as Fe}from"./app-ocUSTWez.js";import{B as h}from"./button-DR7npzIy.js";import{A as Ee}from"./app-layout-CFyL-MFR.js";import{D as $,a as q,b as se,c as ae,d as re}from"./dialog-Mv7gyur6.js";import{T as ke}from"./textarea-CDUA4c7-.js";import{L as c}from"./label-_7y2Eb6J.js";import{S as x,a as p,b as j,c as C,f as a}from"./select-p9iWZbwq.js";import{s as H,E as Te,F as De}from"./notif-Laanu-Q9.js";import Ie from"./ProcessSummaryReport-p8RdZgUK.js";import"./x-B98p-Pwj.js";import"./index-D37lAzaW.js";import"./index-wFEI5Ric.js";import"./index-NtTptlNe.js";import"./index-JdXBdBa6.js";import"./createLucideIcon-B58_hvZM.js";import"./index-BiVnSbTE.js";import"./index-ewetQKco.js";import"./app-logo-icon-Ben4ZkMx.js";import"./index-BSudiyZx.js";const _e=[{title:"Dashboard",href:"/dashboard"}],Me={AJ:"https://ecsm.dilg.gov.ph/?survey=tsj0jhw0q",Chok:"https://ecsm.dilg.gov.ph/?survey=863vrwt84",Kenot:"https://ecsm.dilg.gov.ph/?survey=863vrwt84",Emman:"https://ecsm.dilg.gov.ph/?survey=jo4vvug37",Real:"https://ecsm.dilg.gov.ph/?survey=6l9f0s149"},Ze=()=>{const{auth:i}=le().props,[J,ne]=r.useState(null),[K,ie]=r.useState(null),{logs:k}=le().props,[u,U]=r.useState(k),oe=u?.meta?.current_page??1,de=u?.meta?.per_page??10,[B,T]=r.useState(!1),[ce,b]=r.useState(!1),[G,D]=r.useState(null),[I,v]=r.useState(""),[_,w]=r.useState(""),[he,N]=r.useState(!1),[M,me]=r.useState("all"),[A,ue]=r.useState("all"),[y,ge]=r.useState(""),[S,fe]=r.useState(""),xe=M!=="all"||A!=="all"||y!==""||S!=="",W=u.data.filter(l=>{const t=M==="all"||l.it_staff===M,n=A==="all"||l.status===A,F=new Date(l.finished_date).getTime(),z=!y||F>=new Date(y).setHours(0,0,0,0),X=!S||F<=new Date(S).setHours(23,59,59,999);return t&&n&&z&&X}),[pe,L]=r.useState(!1),[Y,je]=r.useState("all"),[Q,Ce]=r.useState("all"),[R,be]=r.useState(""),[O,ve]=r.useState("");function we(){const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/deploy-commands-local":"/deploy-commands";fetch(t).then(n=>n.json()).then(n=>{alert(n.message)}).catch(()=>{alert("Deployment failed.")})}const Ne=async()=>{const l=new Te.Workbook,t=l.addWorksheet("TA Monitoring Logsheet");t.columns=[{width:5},{width:25},{width:12},{width:12},{width:20},{width:20},{width:20},{width:25},{width:20},{width:15},{width:15},{width:15},{width:15},{width:20},{width:15}];const n=await fetch("/dilg-logo.png").then(s=>s.blob()).then(s=>new Promise(o=>{const d=new FileReader;d.onload=()=>o(d.result),d.readAsArrayBuffer(s)})),F=l.addImage({buffer:n,extension:"png"});t.addImage(F,{tl:{col:1,row:0},ext:{width:85,height:85}}),t.mergeCells("M1:O1"),t.getCell("M1").value="Document Code",t.getCell("M1").alignment={horizontal:"left",vertical:"middle"},t.getCell("M1").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("M1").font={color:{argb:"FFFFFF"},bold:!0},t.mergeCells("M2:O2"),t.getCell("M2").value="FM-QP-DILG-ISTMS-17-02",t.getCell("M2").alignment={horizontal:"center",vertical:"middle"},t.getCell("M2").font={bold:!0},t.getCell("M3").value="Rev. No.",t.getCell("M3").alignment={horizontal:"center",vertical:"top"},t.getCell("M3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("M3").font={color:{argb:"FFFFFF"},bold:!0},t.getCell("N3").value="Eff. Date",t.getCell("N3").alignment={horizontal:"center",vertical:"top"},t.getCell("N3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("N3").font={color:{argb:"FFFFFF"},bold:!0},t.getCell("O3").value="Page",t.getCell("O3").alignment={horizontal:"center",vertical:"top"},t.getCell("O3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("O3").font={color:{argb:"FFFFFF"},bold:!0},t.mergeCells("C2:G2"),t.getCell("C2").value="Department of the Interior and Local Government",t.getCell("C2").alignment={horizontal:"left",vertical:"middle"},t.getCell("C2").font={size:14},t.getRow(2).height=18,t.mergeCells("C3:H4"),t.getCell("C3").value="ICT Technical Assistance Monitoring Logsheet",t.getCell("C3").alignment={horizontal:"left",vertical:"top"},t.getCell("C3").font={size:23,bold:!0},t.getRow(3).height=25,t.mergeCells("A6:O6"),t.getCell("A6").value="PERIOD:",t.getCell("A6").alignment={horizontal:"left",vertical:"middle"};const z={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};["A6","B6","C6","D6","E6","F6","G6","H6","I6","J6","K6","L6","M6","N6","O6","M2","N2","O2","M4","N4","O4"].forEach(s=>{t.getCell(s).border=z}),t.addRow([]),t.mergeCells("A7:A8"),t.getCell("A7").value="NO.",t.mergeCells("B7:B8"),t.getCell("B7").value="ICT TECHNICAL ASSISTANCE REFERENCE NO.",t.mergeCells("C7:D7"),t.getCell("C7").value="RECEIVED",t.getCell("C8").value="DATE",t.getCell("D8").value="TIME",t.mergeCells("E7:E8"),t.getCell("E7").value="NAME OF THE END-USER",t.mergeCells("F7:G8"),t.getCell("F7").value="OFFICE/SERVICE/BUREAU/DIVISION/SECTION/UNIT",t.getCell("F7").alignment={horizontal:"center",vertical:"middle",wrapText:!0},t.getCell("F7").font={bold:!0},t.mergeCells("H7:H8"),t.getCell("H7").value="ISSUE/CONCERN",t.mergeCells("I7:I8"),t.getCell("I7").value="TECHNICAL PERSONNEL ASSIGNED",t.mergeCells("J7:K7"),t.getCell("J7").value="AGREED TIMELINE (if any)",t.getCell("J8").value="DATE",t.getCell("K8").value="TIME",t.mergeCells("L7:M7"),t.getCell("L7").value="COMPLETED",t.getCell("L8").value="DATE",t.getCell("M8").value="TIME",t.mergeCells("N7:N8"),t.getCell("N7").value="TOTAL PROCESSING TIME",t.mergeCells("O7:O8"),t.getCell("O7").value="OVERALL QUALITY RATING",t.getRow(7).height=30,t.getRow(8).height=25;for(let s=7;s<=8;s++)t.getRow(s).eachCell(o=>{o.font={bold:!0},o.alignment={horizontal:"center",vertical:"middle",wrapText:!0},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});u.data.filter(s=>{const o=Y==="all"||s.it_staff===Y,d=Q==="all"||s.status===Q,g=new Date(s.created_at);let f=!0;if(R){const m=new Date(R+"T00:00:00");g<m&&(f=!1)}if(O){const m=new Date(O+"T23:59:59");g>m&&(f=!1)}return o&&d&&f}).forEach((s,o)=>{const d=new Date(s.created_at);let g="-";if(s.finished_date&&s.finished_time){const Z=new Date(`${s.finished_date} ${s.finished_time}`).getTime()-d.getTime(),ee=Math.floor(Z/(1e3*60*60)),te=Math.floor(Z%(1e3*60*60)/(1e3*60));g=ee>0?`${ee}hrs ${te}mins`:`${te}mins`}const f=(s.fname??"")+" "+(s.lname??""),m=t.addRow([o+1,`R8-${s.reference_no}`,d.toLocaleDateString(),d.toLocaleTimeString(),f??"-","-",s.sec_div_unit??"-",s.problem_description??"-",s.it_staff??"-",s.agreed_date??"-",s.agreed_time??"-",s.finished_date??"-",s.finished_time??"-",g,"4"]);m.eachCell(P=>{P.alignment={vertical:"middle",horizontal:"center"},P.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});const E=m.number;t.mergeCells(`F${E}:G${E}`),t.getCell(`F${E}`).value=s.sec_div_unit&&s.sec_div_unit!==""?s.sec_div_unit:"-",t.getCell(`F${E}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const ye=await l.xlsx.writeBuffer();De.saveAs(new Blob([ye]),"RICTU_TA-Monitoring-Logsheet.xlsx")};return r.useEffect(()=>{if(i?.user?.role!=="admin"&&i?.user?.role!=="superadmin")return;const l=setInterval(()=>{fetch("/check-new-requests").then(t=>t.json()).then(t=>{const n=t.latest_id;n&&n!==J&&(ne(n),H(i,"New Support Request","A user has submitted a new request."),V.reload({only:["logs"]}))}).catch(()=>{})},1e4);return()=>clearInterval(l)},[J]),r.useEffect(()=>{if(i?.user?.role!=="admin"&&i?.user?.role!=="superadmin")return;const l=setInterval(()=>{fetch("/check-finished-requests").then(t=>t.json()).then(t=>{t.updated_at&&t.updated_at!==K&&(ie(t.updated_at),H(i,"Request Completed","A user has marked a request as finished."),V.reload({only:["logs"]}))}).catch(()=>{})},1e4);return()=>clearInterval(l)},[K]),r.useEffect(()=>{U(k)},[k]),e.jsxs(Ee,{breadcrumbs:_e,children:[e.jsx(Se,{title:"Dashboard"}),e.jsxs("div",{className:"flex m-4 gap-2",children:[e.jsx(h,{asChild:!0,children:e.jsx(Fe,{href:"/support-form",children:"Contact Support"})}),(i?.user?.role==="admin"||i?.user?.role==="superadmin")&&e.jsx(h,{onClick:we,className:"cursor-pointer",children:"Optimize Routes"})]}),e.jsx($,{open:B,onOpenChange:()=>{},children:e.jsxs(q,{className:"flex flex-col items-center justify-center gap-4 py-10",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-primary",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Processing your request..."})]})}),e.jsx($,{open:ce,onOpenChange:l=>{l?b(!0):(b(!1),N(!1),D(null),v(""),w(""))},children:e.jsx(q,{className:"sm:max-w-md",children:he?e.jsxs("div",{className:"text-center space-y-4 py-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Thank you!"}),e.jsxs("p",{children:["Thanks for completing the request. Please complete answering the",e.jsx("b",{children:" Client Satisfaction Measure System"})," as part of our report. We appreciate your feedback!"]}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("a",{href:Me[I]??"#",target:"_blank",rel:"noopener noreferrer",className:"inline-block px-4 py-2 rounded-md border bg-blue-600 text-white",children:"Go to CSMS Form"}),e.jsx(h,{variant:"outline",onClick:()=>{N(!1),b(!1),v("")},children:"Close"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Update Status"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"it_staff",children:"Select IT Staff"}),e.jsxs(x,{onValueChange:l=>v(l),value:I,children:[e.jsx(p,{id:"it_staff",children:e.jsx(j,{placeholder:"Select IT Staff"})}),e.jsxs(C,{children:[e.jsx(a,{value:"AJ",children:"AJ"}),e.jsx(a,{value:"Chok",children:"Chok"}),e.jsx(a,{value:"Kenot",children:"Kenot"}),e.jsx(a,{value:"Emman",children:"Emman"}),e.jsx(a,{value:"Real",children:"Real"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"remarks",children:"Remarks"}),e.jsx(ke,{id:"remarks",placeholder:"Enter remarks...",value:_,onChange:l=>w(l.target.value)})]})]}),e.jsx(re,{children:e.jsx(h,{disabled:B,onClick:()=>{if(!G)return;const l=G;T(!0),V.put(`/tarf-logs/${l}/status`,{status:"finished",it_staff:I,remarks:_},{onSuccess:()=>{T(!1),U(t=>({...t,data:t.data.map(n=>n.id===l?{...n,status:"finished",remarks:_,finished_date:new Date().toISOString().split("T")[0],finished_time:new Date().toLocaleTimeString()}:n)})),N(!0),D(null),w("")},onError:()=>{T(!1),H(i,"Update failed","Could not update status. Try again.")}})},children:"Submit"})})]})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex flex-3 flex-wrap justify-start gap-10",children:[e.jsx("div",{className:"flex items-end mb-1",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Support Requests"})}),e.jsxs("div",{className:"flex flex-3 flex-wrap justify-start gap-2",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Filter by IT Staff"}),e.jsxs(x,{onValueChange:l=>me(l),defaultValue:"all",children:[e.jsx(p,{className:"w-[180px] dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(j,{placeholder:"All Staff"})}),e.jsxs(C,{children:[e.jsx(a,{value:"all",children:"All"}),e.jsx(a,{value:"AJ",children:"AJ"}),e.jsx(a,{value:"Chok",children:"Chok"}),e.jsx(a,{value:"Kenot",children:"Kenot"}),e.jsx(a,{value:"Emman",children:"Emman"}),e.jsx(a,{value:"Real",children:"Real"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Filter by Status"}),e.jsxs(x,{onValueChange:l=>ue(l),defaultValue:"all",children:[e.jsx(p,{className:"w-[180px] dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(j,{placeholder:"All Status"})}),e.jsxs(C,{children:[e.jsx(a,{value:"all",children:"All"}),e.jsx(a,{value:"pending",children:"Pending"}),e.jsx(a,{value:"finished",children:"Finished"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Filter by Date (From - To)"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"date",className:"w-1/2 dark:bg-gray-800 dark:border-gray-600 dark:text-white border rounded px-2 py-[5px]",value:y,onChange:l=>ge(l.target.value)}),e.jsx("input",{type:"date",className:"w-1/2 dark:bg-gray-800 dark:border-gray-600 dark:text-white border rounded px-2 py-[5px]",value:S,onChange:l=>fe(l.target.value)})]})]})]})]}),e.jsx("div",{className:"flex flex-2 flex-wrap items-end gap-2 justify-end",children:(i?.user?.role==="admin"||i?.user?.role==="superadmin")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center items-center gap-3",children:e.jsx("div",{children:e.jsx(h,{onClick:()=>L(!0),className:"bg-blue-600 hover:bg-blue-700 text-white mt-0 md:mt-5 cursor-pointer",children:"Monitoring Logsheett"})})}),e.jsx(Ie,{})]})})]}),e.jsx("div",{className:"overflow-x-auto border rounded-lg mb-4",children:e.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border",children:"No."}),e.jsx("th",{className:"p-3 border",children:"Sender"}),e.jsx("th",{className:"p-3 border",children:"Request Type"}),e.jsx("th",{className:"p-3 border",children:"Problem Description"}),e.jsx("th",{className:"p-3 border",children:"Uploaded File"}),e.jsx("th",{className:"p-3 border",children:"Request Date"}),e.jsx("th",{className:"p-3 border",children:"IT Staff"}),e.jsx("th",{className:"p-3 border",children:"Finished Date"}),e.jsx("th",{className:"p-3 border",children:"Remarks"}),e.jsx("th",{className:"p-3 border",children:"Action"})]})}),e.jsx("tbody",{children:W.map((l,t)=>e.jsxs("tr",{className:"hover:bg-gray-100 dark:hover:bg-gray-500",children:[e.jsx("td",{className:"p-3 border",children:(oe-1)*de+t+1}),e.jsx("td",{className:"p-3 border",children:l.fname+" "+l.lname}),e.jsx("td",{className:"p-3 border",children:l.request_type_name}),e.jsx("td",{className:"p-3 border",children:l.problem_description||"-"}),e.jsx("td",{className:"p-3 border",children:l.uploaded_file?e.jsx("a",{href:`/storage/${l.uploaded_file}`,target:"_blank",className:"text-blue-600 underline",children:"View File"}):"-"}),e.jsx("td",{className:"p-3 border",children:new Date(l.created_at).toLocaleString()}),e.jsx("td",{className:"p-3 border",children:l.it_staff||"-"}),e.jsx("td",{className:"p-3 border",children:(l.finished_date??"-")+" "+(l.finished_time??"-")}),e.jsx("td",{className:"p-3 border",children:l.remarks??"-"}),e.jsx("td",{className:"p-3 border",children:l.status==="pending"?e.jsx(h,{size:"sm",className:"bg-orange-300 hover:bg-orange-400",onClick:()=>{D(l.id),v(l.it_staff||""),w(l.remarks||""),b(!0),N(!1)},children:"Update Status"}):e.jsx("span",{className:"text-green-700 font-semibold text-sm",children:"✔Finished"})})]},l.id))})]})}),xe?e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Showing ",W.length," result(s) — pagination is disabled while filters are active."]}):e.jsx("div",{className:"flex justify-center mt-4",children:u.links.map((l,t)=>e.jsx("button",{disabled:!l.url,className:`px-3 py-1 mx-1 rounded border ${l.active?"bg-blue-600 text-white":"bg-white text-gray-700"}`,dangerouslySetInnerHTML:{__html:l.label},onClick:()=>{l.url&&(window.location.href=l.url)}},t))})]}),e.jsx($,{open:pe,onOpenChange:L,children:e.jsxs(q,{className:"sm:max-w-md",children:[e.jsx(se,{children:e.jsx(ae,{children:"Download Monitoring Logsheet"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Filter by IT Staff"}),e.jsxs(x,{onValueChange:je,defaultValue:"all",children:[e.jsx(p,{className:"bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(j,{placeholder:"All Staff"})}),e.jsxs(C,{children:[e.jsx(a,{value:"all",children:"All"}),e.jsx(a,{value:"AJ",children:"AJ"}),e.jsx(a,{value:"Chok",children:"Chok"}),e.jsx(a,{value:"Kenot",children:"Kenot"}),e.jsx(a,{value:"Emman",children:"Emman"}),e.jsx(a,{value:"Real",children:"Real"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Filter by Status"}),e.jsxs(x,{onValueChange:Ce,defaultValue:"all",children:[e.jsx(p,{className:"bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(j,{placeholder:"All Status"})}),e.jsxs(C,{children:[e.jsx(a,{value:"all",children:"All"}),e.jsx(a,{value:"pending",children:"Pending"}),e.jsx(a,{value:"finished",children:"Finished"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Date From"}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:R,onChange:l=>be(l.target.value)})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Date To"}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:O,onChange:l=>ve(l.target.value)})]})]}),e.jsx(re,{children:e.jsx(h,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{L(!1),Ne()},children:"Download Logsheet"})})]})})]})};export{Ze as default};
