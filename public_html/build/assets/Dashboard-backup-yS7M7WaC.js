import{K as P,r,S as j,j as t,L as se,$ as ae}from"./app-BdLimzmP.js";import{B as m}from"./button-B06STszK.js";import{A as re}from"./app-layout-BnVW4YQ3.js";import{D as $,a as q,b as ie,c as ne,d as oe}from"./dialog-JuaXoa-m.js";import{T as de}from"./textarea-CE9X6sZZ.js";import{L as u}from"./label-B0oBM-N9.js";import{S as b,a as v,b as N,c as S,f as a}from"./select-CGrUXizW.js";import{s as B,E as ce,F as he}from"./notif-DsIFqnq8.js";/* empty css            */import"./index-C1IvN2Es.js";import"./index-CeOhJs7W.js";import"./index-B_mqUbkG.js";import"./index-wEcUZt9q.js";import"./app-logo-icon-Bvhy-XFl.js";import"./index-D-G9XSpc.js";const me=[{title:"Dashboard",href:"/dashboard"}],ye=()=>{const{auth:d}=P().props,[w,H]=r.useState(null),[E,V]=r.useState(null),{logs:f}=P().props,[c,F]=r.useState(f),G=c?.meta?.current_page??1,U=c?.meta?.per_page??10,[J,g]=r.useState(!1),[x,I]=r.useState(null),[K,y]=r.useState(""),[p,_]=r.useState(""),[W,T]=r.useState(!1),[A,Q]=r.useState("all"),[M,Y]=r.useState("all"),D=c.data.filter(l=>{const e=A==="all"||l.it_staff===A,i=M==="all"||l.status===M;return e&&i}),X=async()=>{const l=new ce.Workbook,e=l.addWorksheet("TA Monitoring Logsheet");e.columns=[{width:5},{width:25},{width:12},{width:12},{width:20},{width:20},{width:20},{width:25},{width:20},{width:15},{width:15},{width:15},{width:15},{width:20},{width:15}];const i=await fetch("/dilg-logo.png").then(s=>s.blob()).then(s=>new Promise(n=>{const o=new FileReader;o.onload=()=>n(o.result),o.readAsArrayBuffer(s)})),Z=l.addImage({buffer:i,extension:"png"});e.addImage(Z,{tl:{col:1,row:0},ext:{width:85,height:85}}),e.mergeCells("M1:O1"),e.getCell("M1").value="Document Code",e.getCell("M1").alignment={horizontal:"left",vertical:"middle"},e.getCell("M1").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},e.getCell("M1").font={color:{argb:"FFFFFF"},bold:!0},e.mergeCells("M2:O2"),e.getCell("M2").value="FM-QP-DILG-ISTMS-17-02",e.getCell("M2").alignment={horizontal:"center",vertical:"middle"},e.getCell("M2").font={bold:!0},e.getCell("M3").value="Rev. No.",e.getCell("M3").alignment={horizontal:"center",vertical:"top"},e.getCell("M3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},e.getCell("M3").font={color:{argb:"FFFFFF"},bold:!0},e.getCell("N3").value="Eff. Date",e.getCell("N3").alignment={horizontal:"center",vertical:"top"},e.getCell("N3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},e.getCell("N3").font={color:{argb:"FFFFFF"},bold:!0},e.getCell("O3").value="Page",e.getCell("O3").alignment={horizontal:"center",vertical:"top"},e.getCell("O3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},e.getCell("O3").font={color:{argb:"FFFFFF"},bold:!0},e.mergeCells("C2:G2"),e.getCell("C2").value="Department of the Interior and Local Government",e.getCell("C2").alignment={horizontal:"left",vertical:"middle"},e.getCell("C2").font={size:14},e.getRow(2).height=18,e.mergeCells("C3:H4"),e.getCell("C3").value="ICT Technical Assistance Monitoring Logsheet",e.getCell("C3").alignment={horizontal:"left",vertical:"top"},e.getCell("C3").font={size:23,bold:!0},e.getRow(3).height=25,e.mergeCells("A6:O6"),e.getCell("A6").value="PERIOD:",e.getCell("A6").alignment={horizontal:"left",vertical:"middle"};const ee={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};["A6","B6","C6","D6","E6","F6","G6","H6","I6","J6","K6","L6","M6","N6","O6","M2","N2","O2","M4","N4","O4"].forEach(s=>{e.getCell(s).border=ee}),e.addRow([]),e.mergeCells("A7:A8"),e.getCell("A7").value="NO.",e.mergeCells("B7:B8"),e.getCell("B7").value="ICT TECHNICAL ASSISTANCE REFERENCE NO.",e.mergeCells("C7:D7"),e.getCell("C7").value="RECEIVED",e.getCell("C8").value="DATE",e.getCell("D8").value="TIME",e.mergeCells("E7:E8"),e.getCell("E7").value="NAME OF THE END-USER",e.mergeCells("F7:G8"),e.getCell("F7").value="OFFICE/SERVICE/BUREAU/DIVISION/SECTION/UNIT",e.getCell("F7").alignment={horizontal:"center",vertical:"middle",wrapText:!0},e.getCell("F7").font={bold:!0},e.mergeCells("H7:H8"),e.getCell("H7").value="ISSUE/CONCERN",e.mergeCells("I7:I8"),e.getCell("I7").value="TECHNICAL PERSONNEL ASSIGNED",e.mergeCells("J7:K7"),e.getCell("J7").value="AGREED TIMELINE (if any)",e.getCell("J8").value="DATE",e.getCell("K8").value="TIME",e.mergeCells("L7:M7"),e.getCell("L7").value="COMPLETED",e.getCell("L8").value="DATE",e.getCell("M8").value="TIME",e.mergeCells("N7:N8"),e.getCell("N7").value="TOTAL PROCESSING TIME",e.mergeCells("O7:O8"),e.getCell("O7").value="OVERALL QUALITY RATING",e.getRow(7).height=30,e.getRow(8).height=25;for(let s=7;s<=8;s++)e.getRow(s).eachCell(n=>{n.font={bold:!0},n.alignment={horizontal:"center",vertical:"middle",wrapText:!0},n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});D.forEach((s,n)=>{const o=new Date(s.created_at);let L="-";if(s.finished_date&&s.finished_time){const O=new Date(`${s.finished_date} ${s.finished_time}`).getTime()-o.getTime(),k=Math.floor(O/(1e3*60*60)),z=Math.floor(O%(1e3*60*60)/(1e3*60));L=k>0?`${k}hrs ${z}mins`:`${z}mins`}const le=(s.fname??"")+" "+(s.lname??""),R=e.addRow([n+1,s.reference_no,o.toLocaleDateString(),o.toLocaleTimeString(),le??"-","-",s.sec_div_unit??"-",s.problem_description??"-",s.it_staff??"-",s.agreed_date??"-",s.agreed_time??"-",s.finished_date??"-",s.finished_time??"-",L,"4"]);R.eachCell(C=>{C.alignment={vertical:"middle",horizontal:"center"},C.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});const h=R.number;e.mergeCells(`F${h}:G${h}`),e.getCell(`F${h}`).value=s.sec_div_unit&&s.sec_div_unit!==""?s.sec_div_unit:"-",e.getCell(`F${h}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const te=await l.xlsx.writeBuffer();he.saveAs(new Blob([te]),"RICTU_TA-Monitoring-Logsheet.xlsx")};return r.useEffect(()=>{if(d?.user?.role!=="admin")return;const l=setInterval(()=>{fetch("/check-new-requests").then(e=>e.json()).then(e=>{const i=e.latest_id;i&&i!==w&&(H(i),B(d,"New Support Request","A user has submitted a new request."),j.reload({only:["logs"]}))})},1e4);return()=>clearInterval(l)},[w]),r.useEffect(()=>{if(d?.user?.role!=="admin")return;const l=setInterval(()=>{fetch("/check-finished-requests").then(e=>e.json()).then(e=>{e.updated_at&&e.updated_at!==E&&(V(e.updated_at),B(d,"Request Completed","A user has marked a request as finished."),j.reload({only:["logs"]}))})},1e4);return()=>clearInterval(l)},[E]),r.useEffect(()=>{F(f)},[f]),t.jsxs(re,{breadcrumbs:me,children:[t.jsx(se,{title:"Dashboard"}),t.jsx("div",{className:"flex m-4",children:t.jsx(m,{asChild:!0,children:t.jsx(ae,{href:"/support-form",children:"Contact Support"})})}),t.jsx($,{open:W,children:t.jsxs(q,{className:"flex flex-col items-center justify-center gap-4 py-10",children:[t.jsxs("svg",{className:"animate-spin h-8 w-8 text-primary",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Processing your request..."})]})}),t.jsx($,{open:J,onOpenChange:g,children:t.jsxs(q,{className:"sm:max-w-md",children:[t.jsx(ie,{children:t.jsx(ne,{children:"Update Status"})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(u,{htmlFor:"it_staff",children:"Select IT Staff"}),t.jsxs(b,{onValueChange:y,children:[t.jsx(v,{id:"it_staff",children:t.jsx(N,{placeholder:"Select IT Staff"})}),t.jsxs(S,{children:[t.jsx(a,{value:"AJ",children:"AJ"}),t.jsx(a,{value:"Chok",children:"Chok"}),t.jsx(a,{value:"Kenot",children:"Kenot"}),t.jsx(a,{value:"Emman",children:"Emman"}),t.jsx(a,{value:"Real",children:"Real"})]})]})]}),t.jsxs("div",{children:[t.jsx(u,{htmlFor:"remarks",children:"Remarks"}),t.jsx(de,{id:"remarks",placeholder:"Enter remarks...",value:p,onChange:l=>_(l.target.value)})]})]}),t.jsx(oe,{children:t.jsx(m,{onClick:()=>{x&&(T(!0),j.put(`/tarf-logs/${x}/status`,{status:"finished",it_staff:K,remarks:p},{onSuccess:()=>{T(!1),g(!1),I(null),y(""),_(""),F(l=>({...l,data:l.data.map(e=>e.id===x?{...e,status:"finished",remarks:p,finished_date:new Date().toISOString().split("T")[0],finished_time:new Date().toLocaleTimeString()}:e)}))}}))},children:"Submit"})})]})}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("div",{className:"flex flex-1",children:t.jsx("h1",{className:"text-2xl font-bold",children:"Support Requests"})}),t.jsx("div",{className:"flex flex-3 justify-between items-center gap-3",children:d?.user?.role==="admin"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-center items-center gap-3",children:[t.jsxs("div",{children:[t.jsx(u,{children:"Filter by IT Staff"}),t.jsxs(b,{onValueChange:Q,defaultValue:"all",children:[t.jsx(v,{className:"w-[180px]",children:t.jsx(N,{placeholder:"All Staff"})}),t.jsxs(S,{children:[t.jsx(a,{value:"all",children:"All"}),t.jsx(a,{value:"AJ",children:"AJ"}),t.jsx(a,{value:"Chok",children:"Chok"}),t.jsx(a,{value:"Kenot",children:"Kenot"}),t.jsx(a,{value:"Emman",children:"Emman"}),t.jsx(a,{value:"Real",children:"Real"})]})]})]}),t.jsxs("div",{children:[t.jsx(u,{children:"Filter by Status"}),t.jsxs(b,{onValueChange:Y,defaultValue:"all",children:[t.jsx(v,{className:"w-[180px]",children:t.jsx(N,{placeholder:"All Status"})}),t.jsxs(S,{children:[t.jsx(a,{value:"all",children:"All"}),t.jsx(a,{value:"pending",children:"Pending"}),t.jsx(a,{value:"finished",children:"Finished"})]})]})]})]}),t.jsx(m,{onClick:X,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Download Logsheet"})]})})]}),t.jsx("div",{className:"overflow-x-auto border rounded-lg mb-4",children:t.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[t.jsx("thead",{className:"bg-gray-100 dark:bg-gray-500",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-3 border",children:"No."}),t.jsx("th",{className:"p-3 border",children:"Request Type"}),t.jsx("th",{className:"p-3 border",children:"Equipment Concern"}),t.jsx("th",{className:"p-3 border",children:"Brand"}),t.jsx("th",{className:"p-3 border",children:"Problem Description"}),t.jsx("th",{className:"p-3 border",children:"Uploaded File"}),t.jsx("th",{className:"p-3 border",children:"Request Date"}),t.jsx("th",{className:"p-3 border",children:"IT Staff"}),t.jsx("th",{className:"p-3 border",children:"Finished Date"}),t.jsx("th",{className:"p-3 border",children:"Remarks"}),t.jsx("th",{className:"p-3 border",children:"Action"})]})}),t.jsx("tbody",{children:D.map((l,e)=>t.jsxs("tr",{className:"hover:bg-gray-100 dark:hover:bg-gray-500",children:[t.jsx("td",{className:"p-3 border",children:(G-1)*U+e+1}),t.jsx("td",{className:"p-3 border",children:l.request_type_name}),t.jsx("td",{className:"p-3 border",children:l.equipment_concern||"-"}),t.jsx("td",{className:"p-3 border",children:l.brand||"-"}),t.jsx("td",{className:"p-3 border",children:l.problem_description||"-"}),t.jsx("td",{className:"p-3 border",children:l.uploaded_file?t.jsx("a",{href:`/storage/${l.uploaded_file}`,target:"_blank",className:"text-blue-600 underline",children:"View File"}):"-"}),t.jsx("td",{className:"p-3 border",children:new Date(l.created_at).toLocaleString()}),t.jsx("td",{className:"p-3 border",children:l.it_staff||"-"}),t.jsx("td",{className:"p-3 border",children:(l.finished_date??"-")+" "+(l.finished_time??"-")}),t.jsx("td",{className:"p-3 border",children:l.remarks??"-"}),t.jsx("td",{className:"p-3 border",children:l.status==="pending"?t.jsx(m,{size:"sm",className:"bg-orange-300 hover:bg-orange-400",onClick:()=>{I(l.id),g(!0)},children:"Update Status"}):t.jsx("span",{className:"text-green-700 font-semibold text-sm",children:"âœ”Finished"})})]},l.id))})]})}),t.jsx("div",{className:"flex justify-center mt-4",children:c.links.map((l,e)=>t.jsx("button",{disabled:!l.url,className:`px-3 py-1 mx-1 rounded border ${l.active?"bg-blue-600 text-white":"bg-white text-gray-700"}`,dangerouslySetInnerHTML:{__html:l.label},onClick:()=>{l.url&&(window.location.href=l.url)}},e))})]})]})};export{ye as default};
