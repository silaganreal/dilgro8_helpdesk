import{u as U,r,b as E,j as e,H as ne,L as oe}from"./app-RoT9avqR.js";import{B as c}from"./button-DdcaEAlZ.js";import{A as de}from"./app-layout-DVqPIjQg.js";import{D as V,a as B,b as ce,c as he,d as me}from"./dialog-DS31P51a.js";import{T as ue}from"./textarea-C8A5WWGO.js";import{L as x}from"./label-CXEQQPQv.js";import{S as F,a as I,b as T,c as _,f as i}from"./select-DA0JI7mq.js";import{s as k,E as fe,F as ge}from"./notif-BGtYOi0T.js";import pe from"./ProcessSummaryReport-Dj6YebJM.js";import"./x-g3ZtXfOQ.js";import"./index-kA1PlfkV.js";import"./index-pn3pvSuk.js";import"./index-6RCIpGiD.js";import"./index-D9W8DLms.js";import"./createLucideIcon-BewuhNKB.js";import"./index-DmknuZ9n.js";import"./index-BlrUdczg.js";import"./app-logo-icon-UXvY_2KQ.js";import"./index-Dlo8dmql.js";const xe=[{title:"Dashboard",href:"/dashboard"}],Ce={AJ:"https://ecsm.dilg.gov.ph/?survey=tsj0jhw0q",Chok:"https://ecsm.dilg.gov.ph/?survey=863vrwt84",Kenot:"https://ecsm.dilg.gov.ph/?survey=863vrwt84",Emman:"https://ecsm.dilg.gov.ph/?survey=jo4vvug37",Real:"https://ecsm.dilg.gov.ph/?survey=6l9f0s149"},ze=()=>{const{auth:n}=U().props,[A,G]=r.useState(null),[M,J]=r.useState(null),{logs:C}=U().props,[h,R]=r.useState(C),K=h?.meta?.current_page??1,W=h?.meta?.per_page??10,[L,j]=r.useState(!1),[Y,m]=r.useState(!1),[D,b]=r.useState(null),[v,u]=r.useState(""),[N,f]=r.useState(""),[Q,g]=r.useState(!1),[w,X]=r.useState("all"),[S,Z]=r.useState("all"),ee=w!=="all"||S!=="all",O=h.data.filter(l=>{const t=w==="all"||l.it_staff===w,a=S==="all"||l.status===S;return t&&a});function te(){const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/deploy-commands-local":"/deploy-commands";fetch(t).then(a=>a.json()).then(a=>{alert(a.message)}).catch(()=>{alert("Deployment failed.")})}const le=async()=>{const l=new fe.Workbook,t=l.addWorksheet("TA Monitoring Logsheet");t.columns=[{width:5},{width:25},{width:12},{width:12},{width:20},{width:20},{width:20},{width:25},{width:20},{width:15},{width:15},{width:15},{width:15},{width:20},{width:15}];const a=await fetch("/dilg-logo.png").then(s=>s.blob()).then(s=>new Promise(o=>{const d=new FileReader;d.onload=()=>o(d.result),d.readAsArrayBuffer(s)})),se=l.addImage({buffer:a,extension:"png"});t.addImage(se,{tl:{col:1,row:0},ext:{width:85,height:85}}),t.mergeCells("M1:O1"),t.getCell("M1").value="Document Code",t.getCell("M1").alignment={horizontal:"left",vertical:"middle"},t.getCell("M1").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("M1").font={color:{argb:"FFFFFF"},bold:!0},t.mergeCells("M2:O2"),t.getCell("M2").value="FM-QP-DILG-ISTMS-17-02",t.getCell("M2").alignment={horizontal:"center",vertical:"middle"},t.getCell("M2").font={bold:!0},t.getCell("M3").value="Rev. No.",t.getCell("M3").alignment={horizontal:"center",vertical:"top"},t.getCell("M3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("M3").font={color:{argb:"FFFFFF"},bold:!0},t.getCell("N3").value="Eff. Date",t.getCell("N3").alignment={horizontal:"center",vertical:"top"},t.getCell("N3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("N3").font={color:{argb:"FFFFFF"},bold:!0},t.getCell("O3").value="Page",t.getCell("O3").alignment={horizontal:"center",vertical:"top"},t.getCell("O3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("O3").font={color:{argb:"FFFFFF"},bold:!0},t.mergeCells("C2:G2"),t.getCell("C2").value="Department of the Interior and Local Government",t.getCell("C2").alignment={horizontal:"left",vertical:"middle"},t.getCell("C2").font={size:14},t.getRow(2).height=18,t.mergeCells("C3:H4"),t.getCell("C3").value="ICT Technical Assistance Monitoring Logsheet",t.getCell("C3").alignment={horizontal:"left",vertical:"top"},t.getCell("C3").font={size:23,bold:!0},t.getRow(3).height=25,t.mergeCells("A6:O6"),t.getCell("A6").value="PERIOD:",t.getCell("A6").alignment={horizontal:"left",vertical:"middle"};const ae={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};["A6","B6","C6","D6","E6","F6","G6","H6","I6","J6","K6","L6","M6","N6","O6","M2","N2","O2","M4","N4","O4"].forEach(s=>{t.getCell(s).border=ae}),t.addRow([]),t.mergeCells("A7:A8"),t.getCell("A7").value="NO.",t.mergeCells("B7:B8"),t.getCell("B7").value="ICT TECHNICAL ASSISTANCE REFERENCE NO.",t.mergeCells("C7:D7"),t.getCell("C7").value="RECEIVED",t.getCell("C8").value="DATE",t.getCell("D8").value="TIME",t.mergeCells("E7:E8"),t.getCell("E7").value="NAME OF THE END-USER",t.mergeCells("F7:G8"),t.getCell("F7").value="OFFICE/SERVICE/BUREAU/DIVISION/SECTION/UNIT",t.getCell("F7").alignment={horizontal:"center",vertical:"middle",wrapText:!0},t.getCell("F7").font={bold:!0},t.mergeCells("H7:H8"),t.getCell("H7").value="ISSUE/CONCERN",t.mergeCells("I7:I8"),t.getCell("I7").value="TECHNICAL PERSONNEL ASSIGNED",t.mergeCells("J7:K7"),t.getCell("J7").value="AGREED TIMELINE (if any)",t.getCell("J8").value="DATE",t.getCell("K8").value="TIME",t.mergeCells("L7:M7"),t.getCell("L7").value="COMPLETED",t.getCell("L8").value="DATE",t.getCell("M8").value="TIME",t.mergeCells("N7:N8"),t.getCell("N7").value="TOTAL PROCESSING TIME",t.mergeCells("O7:O8"),t.getCell("O7").value="OVERALL QUALITY RATING",t.getRow(7).height=30,t.getRow(8).height=25;for(let s=7;s<=8;s++)t.getRow(s).eachCell(o=>{o.font={bold:!0},o.alignment={horizontal:"center",vertical:"middle",wrapText:!0},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});h.data.forEach((s,o)=>{const d=new Date(s.created_at);let z="-";if(s.finished_date&&s.finished_time){const q=new Date(`${s.finished_date} ${s.finished_time}`).getTime()-d.getTime(),H=Math.floor(q/(1e3*60*60)),$=Math.floor(q%(1e3*60*60)/(1e3*60));z=H>0?`${H}hrs ${$}mins`:`${$}mins`}const ie=(s.fname??"")+" "+(s.lname??""),P=t.addRow([o+1,`R8-${s.reference_no}`,d.toLocaleDateString(),d.toLocaleTimeString(),ie??"-","-",s.sec_div_unit??"-",s.problem_description??"-",s.it_staff??"-",s.agreed_date??"-",s.agreed_time??"-",s.finished_date??"-",s.finished_time??"-",z,"4"]);P.eachCell(y=>{y.alignment={vertical:"middle",horizontal:"center"},y.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});const p=P.number;t.mergeCells(`F${p}:G${p}`),t.getCell(`F${p}`).value=s.sec_div_unit&&s.sec_div_unit!==""?s.sec_div_unit:"-",t.getCell(`F${p}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const re=await l.xlsx.writeBuffer();ge.saveAs(new Blob([re]),"RICTU_TA-Monitoring-Logsheet.xlsx")};return r.useEffect(()=>{if(n?.user?.role!=="admin")return;const l=setInterval(()=>{fetch("/check-new-requests").then(t=>t.json()).then(t=>{const a=t.latest_id;a&&a!==A&&(G(a),k(n,"New Support Request","A user has submitted a new request."),E.reload({only:["logs"]}))}).catch(()=>{})},1e4);return()=>clearInterval(l)},[A]),r.useEffect(()=>{if(n?.user?.role!=="admin")return;const l=setInterval(()=>{fetch("/check-finished-requests").then(t=>t.json()).then(t=>{t.updated_at&&t.updated_at!==M&&(J(t.updated_at),k(n,"Request Completed","A user has marked a request as finished."),E.reload({only:["logs"]}))}).catch(()=>{})},1e4);return()=>clearInterval(l)},[M]),r.useEffect(()=>{R(C)},[C]),e.jsxs(de,{breadcrumbs:xe,children:[e.jsx(ne,{title:"Dashboard"}),e.jsxs("div",{className:"flex m-4 gap-2",children:[e.jsx(c,{asChild:!0,children:e.jsx(oe,{href:"/support-form",children:"Contact Support"})}),(n?.user?.role==="admin"||n?.user?.role==="superadmin")&&e.jsx(c,{onClick:te,children:"Optimize Routes"})]}),e.jsx(V,{open:L,onOpenChange:()=>{},children:e.jsxs(B,{className:"flex flex-col items-center justify-center gap-4 py-10",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-primary",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Processing your request..."})]})}),e.jsx(V,{open:Y,onOpenChange:l=>{l?m(!0):(m(!1),g(!1),b(null),u(""),f(""))},children:e.jsx(B,{className:"sm:max-w-md",children:Q?e.jsxs("div",{className:"text-center space-y-4 py-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Thank you!"}),e.jsxs("p",{children:["Thanks for completing the request. Please complete answering the",e.jsx("b",{children:" Client Satisfaction Measure System"})," as part of our report. We appreciate your feedback!"]}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("a",{href:Ce[v]??"#",target:"_blank",rel:"noopener noreferrer",className:"inline-block px-4 py-2 rounded-md border bg-blue-600 text-white",children:"Go to CSMS Form"}),e.jsx(c,{variant:"outline",onClick:()=>{g(!1),m(!1),u("")},children:"Close"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsx(he,{children:"Update Status"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"it_staff",children:"Select IT Staff"}),e.jsxs(F,{onValueChange:l=>u(l),value:v,children:[e.jsx(I,{id:"it_staff",children:e.jsx(T,{placeholder:"Select IT Staff"})}),e.jsxs(_,{children:[e.jsx(i,{value:"AJ",children:"AJ"}),e.jsx(i,{value:"Chok",children:"Chok"}),e.jsx(i,{value:"Kenot",children:"Kenot"}),e.jsx(i,{value:"Emman",children:"Emman"}),e.jsx(i,{value:"Real",children:"Real"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"remarks",children:"Remarks"}),e.jsx(ue,{id:"remarks",placeholder:"Enter remarks...",value:N,onChange:l=>f(l.target.value)})]})]}),e.jsx(me,{children:e.jsx(c,{disabled:L,onClick:()=>{if(!D)return;const l=D;j(!0),E.put(`/tarf-logs/${l}/status`,{status:"finished",it_staff:v,remarks:N},{onSuccess:()=>{j(!1),R(t=>({...t,data:t.data.map(a=>a.id===l?{...a,status:"finished",remarks:N,finished_date:new Date().toISOString().split("T")[0],finished_time:new Date().toLocaleTimeString()}:a)})),g(!0),b(null),f("")},onError:()=>{j(!1),k(n,"Update failed","Could not update status. Try again.")}})},children:"Submit"})})]})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"flex flex-1",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Support Requests"})}),e.jsx("div",{className:"flex flex-3 flex-wrap justify-between items-end gap-3",children:(n?.user?.role==="admin"||n?.user?.role==="superadmin")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Filter by IT Staff"}),e.jsxs(F,{onValueChange:l=>X(l),defaultValue:"all",children:[e.jsx(I,{className:"w-[180px] dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(T,{placeholder:"All Staff"})}),e.jsxs(_,{children:[e.jsx(i,{value:"all",children:"All"}),e.jsx(i,{value:"AJ",children:"AJ"}),e.jsx(i,{value:"Chok",children:"Chok"}),e.jsx(i,{value:"Kenot",children:"Kenot"}),e.jsx(i,{value:"Emman",children:"Emman"}),e.jsx(i,{value:"Real",children:"Real"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Filter by Status"}),e.jsxs(F,{onValueChange:l=>Z(l),defaultValue:"all",children:[e.jsx(I,{className:"w-[180px] dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(T,{placeholder:"All Status"})}),e.jsxs(_,{children:[e.jsx(i,{value:"all",children:"All"}),e.jsx(i,{value:"pending",children:"Pending"}),e.jsx(i,{value:"finished",children:"Finished"})]})]})]}),e.jsx("div",{children:e.jsx(c,{onClick:le,className:"bg-blue-600 hover:bg-blue-700 text-white mt-0 md:mt-5",children:"Monitoring Logsheet"})})]}),e.jsx(pe,{})]})})]}),e.jsx("div",{className:"overflow-x-auto border rounded-lg mb-4",children:e.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border",children:"No."}),e.jsx("th",{className:"p-3 border",children:"Sender"}),e.jsx("th",{className:"p-3 border",children:"Request Type"}),e.jsx("th",{className:"p-3 border",children:"Problem Description"}),e.jsx("th",{className:"p-3 border",children:"Uploaded File"}),e.jsx("th",{className:"p-3 border",children:"Request Date"}),e.jsx("th",{className:"p-3 border",children:"IT Staff"}),e.jsx("th",{className:"p-3 border",children:"Finished Date"}),e.jsx("th",{className:"p-3 border",children:"Remarks"}),e.jsx("th",{className:"p-3 border",children:"Action"})]})}),e.jsx("tbody",{children:O.map((l,t)=>e.jsxs("tr",{className:"hover:bg-gray-100 dark:hover:bg-gray-500",children:[e.jsx("td",{className:"p-3 border",children:(K-1)*W+t+1}),e.jsx("td",{className:"p-3 border",children:l.fname+" "+l.lname}),e.jsx("td",{className:"p-3 border",children:l.request_type_name}),e.jsx("td",{className:"p-3 border",children:l.problem_description||"-"}),e.jsx("td",{className:"p-3 border",children:l.uploaded_file?e.jsx("a",{href:`/storage/${l.uploaded_file}`,target:"_blank",className:"text-blue-600 underline",children:"View File"}):"-"}),e.jsx("td",{className:"p-3 border",children:new Date(l.created_at).toLocaleString()}),e.jsx("td",{className:"p-3 border",children:l.it_staff||"-"}),e.jsx("td",{className:"p-3 border",children:(l.finished_date??"-")+" "+(l.finished_time??"-")}),e.jsx("td",{className:"p-3 border",children:l.remarks??"-"}),e.jsx("td",{className:"p-3 border",children:l.status==="pending"?e.jsx(c,{size:"sm",className:"bg-orange-300 hover:bg-orange-400",onClick:()=>{b(l.id),u(l.it_staff||""),f(l.remarks||""),m(!0),g(!1)},children:"Update Status"}):e.jsx("span",{className:"text-green-700 font-semibold text-sm",children:"✔Finished"})})]},l.id))})]})}),ee?e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Showing ",O.length," result(s) — pagination is disabled while filters are active."]}):e.jsx("div",{className:"flex justify-center mt-4",children:h.links.map((l,t)=>e.jsx("button",{disabled:!l.url,className:`px-3 py-1 mx-1 rounded border ${l.active?"bg-blue-600 text-white":"bg-white text-gray-700"}`,dangerouslySetInnerHTML:{__html:l.label},onClick:()=>{l.url&&(window.location.href=l.url)}},t))})]})]})};export{ze as default};
