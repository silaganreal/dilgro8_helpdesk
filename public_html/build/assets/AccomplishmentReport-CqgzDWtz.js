import{K as te,r as w,j as r}from"./app-ocUSTWez.js";import{s as v,E as le,F as re}from"./notif-Laanu-Q9.js";import{B as S}from"./button-DR7npzIy.js";import{L as F}from"./label-_7y2Eb6J.js";import{D as ae,a as ne,b as oe,c as ie,d as se}from"./dialog-Mv7gyur6.js";import"./index-wFEI5Ric.js";import"./x-B98p-Pwj.js";import"./index-D37lAzaW.js";import"./index-NtTptlNe.js";import"./index-JdXBdBa6.js";import"./createLucideIcon-B58_hvZM.js";function ve(){const{auth:$,logs:E}=te().props,R=Array.isArray(E)?E:E?.data??[],[h,k]=w.useState(""),[C,j]=w.useState(""),[T,N]=w.useState(!1),[G,y]=w.useState(!1),[u,K]=w.useState("all"),_=w.useMemo(()=>{const t=new Set;return R.forEach(n=>{n.it_staff&&n.it_staff.trim()!==""&&t.add(n.it_staff)}),["all",...Array.from(t)]},[R]),O=async()=>{try{const t=await fetch("/dilg-logo.png");if(!t.ok)return null;const n=await t.blob();return await new Promise((e,c)=>{const g=new FileReader;g.onload=()=>e(g.result),g.onerror=c,g.readAsArrayBuffer(n)})}catch{return null}},B=t=>!!(t.status&&typeof t.status=="string"&&t.status.toLowerCase()==="finished"||t.finished_date&&t.finished_date.toString().trim()!==""),I=t=>{if(!t)return"-";const n=typeof t=="string"?new Date(t):t;if(isNaN(n.getTime()))return"-";const e=n.getDate(),c=n.toLocaleString("default",{month:"short"});return`${e}-${c}`},M=async t=>{const n=new le.Workbook,e=n.addWorksheet("Accomplishment Report");e.columns=[{width:4},{width:35},{width:12},{width:12},{width:10},{width:12},{width:12},{width:12},{width:12},{width:10},{width:10},{width:18}];const c=await O();if(c)try{const a=n.addImage({buffer:c,extension:"png"});e.addImage(a,{tl:{col:.2,row:.1},ext:{width:85,height:85}})}catch{}e.mergeCells("K1:L1"),e.getCell("K1").value="Document Code",e.getCell("K1").font={bold:!0},e.getCell("K1").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},e.getCell("K1").font={color:{argb:"FFFFFF"},bold:!0},e.getCell("K1").alignment={horizontal:"left",vertical:"middle"},e.mergeCells("K2:L2"),e.getCell("K2").value="FM-QP-DILG-AS-27-04",e.getCell("K2").alignment={horizontal:"center",vertical:"middle"},e.getCell("K2").font={bold:!0,size:14},e.getCell("K3").value="Rev.No.",e.getCell("L3").value="Eff. Date",e.getCell("K4").value="00",e.getCell("L4").value="06.15.21",e.getCell("K5").value="Page",e.getCell("L5").value="1 of 1",["K1","K2","K3","L3","K4","L4","K5","L5"].forEach(a=>{const m=e.getCell(a);m.alignment={horizontal:"center",vertical:"middle"},m.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),e.mergeCells("C1:G1"),e.getCell("C1").value="DEPARTMENT OF THE INTERIOR AND LOCAL GOVERNMENT",e.getCell("C1").font={size:14,bold:!0},e.getCell("C1").alignment={horizontal:"left",vertical:"middle"},e.mergeCells("C2:G2"),e.getCell("C2").value="MONTHLY MONITORING OF INDIVIDUAL ACCOMPLISHMENTS",e.getCell("C2").font={size:18,bold:!0},e.getCell("C2").alignment={horizontal:"left",vertical:"middle"};let g="For the month of ";if(h&&C){const a=new Date(h),m=new Date(C),d=a.toLocaleString("default",{month:"long"}),D=m.toLocaleString("default",{month:"long"});g+=d===D?`${d} ${a.getFullYear()}`:`${d} - ${D} ${m.getFullYear()}`}else{const a=new Date;g+=`${a.toLocaleString("default",{month:"long"}).toUpperCase()} ${a.getFullYear()}`}e.mergeCells("C3:G3"),e.getCell("C3").value=g,e.getCell("C3").alignment={horizontal:"left",vertical:"middle"};const b=u&&u!=="all"?u:"REAL V. SILAGAN";e.mergeCells("A6:I6"),e.getCell("A6").value=`Name & Signature of Employee: ${b}`,e.getCell("A6").font={bold:!0},e.getCell("A6").alignment={horizontal:"left",vertical:"middle"},e.getCell("A6").border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},e.mergeCells("J6:L6"),e.getCell("J6").value="Office Assignment: ORD-RICTU/Regional Office/Region 8",e.getCell("J6").alignment={horizontal:"left",vertical:"middle"},e.getCell("J6").border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};const l=7,o=8;e.mergeCells(`B${l}:B${o}`),e.getCell(`B${l}`).value=`WORK/ACTIVITY
(1)`,e.getCell(`B${l}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0},e.mergeCells(`C${l}:C${o}`),e.getCell(`C${l}`).value=`REFERENCE CODE
(2)`,e.getCell(`C${l}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0},e.mergeCells(`D${l}:E${l}`),e.getCell(`D${l}`).value=`EFFECTIVENESS/
QUALITY (3)`,e.getCell(`D${l}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0},e.getCell(`D${o}`).value=`No. of Revisions/
Quality of Output`,e.getCell(`E${o}`).value="Rating",e.getCell(`D${o}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0},e.getCell(`E${o}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0},e.mergeCells(`F${l}:F${o}`),e.getCell(`F${l}`).value=`EFFICIENCY
(No. of outputs - fixed or running targets) (4)`,e.getCell(`F${l}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0},e.mergeCells(`G${l}:K${l}`),e.getCell(`G${l}`).value=`TIMELINESS
(EFFICIENCY if enrolled in the Citizen's Charter) (5)`,e.getCell(`G${l}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0},e.getCell(`G${o}`).value=`Target
Date of Completion`,e.getCell(`H${o}`).value=`Started
(Date of Receipt)`,e.getCell(`I${o}`).value="Finished",e.getCell(`J${o}`).value="Result",e.getCell(`K${o}`).value="Rating",e.mergeCells(`L${l}:L${o}`),e.getCell(`L${l}`).value=`REMARKS
(6)`,e.getCell(`L${l}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0};for(let a=l;a<=o;a++){const m=e.getRow(a);m.height=a===l?30:25,m.eachCell({includeEmpty:!0},d=>{d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"D9D9D9"}},d.font={bold:!0,size:10},d.alignment={horizontal:"center",vertical:"middle",wrapText:!0},d.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}t.forEach((a,m)=>{const d=a.problem_description?.trim()??"",D="106.1",W=0,J=4,U=4,Q="1 Day",x=a.created_at?new Date(a.created_at):null,q=x?I(x):"-",X=a.finished_date?I(new Date(a.finished_date)):"-";let f="Work Suspension/Holiday",L="";if(d!==""){if(x){const p=x.getDay();p===6?f="Saturday":p===0?f="Sunday":f="Done"}else f="Done";L=f==="Work Suspension/Holiday"?"":"Done"}else f="Work Suspension/Holiday",L="";const z=e.addRow([m+1,d||"-",D,W,J,U,Q,q,X,L,4,f]);z.eachCell({includeEmpty:!0},(p,ee)=>{p.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},ee===2?p.alignment={horizontal:"left",vertical:"middle",wrapText:!0}:p.alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const Z=e.getCell(`L${z.number}`);["Saturday","Sunday","Work Suspension/Holiday","Holiday"].includes(f)&&(Z.font={color:{argb:"FF0000"},bold:!0})}),e.addRow([]),e.addRow([]);const A=e.lastRow.number+1;e.mergeCells(`A${A}:B${A}`),e.getCell(`A${A}`).value="Prepared by:",e.getCell(`A${A}`).alignment={horizontal:"left"},e.addRow([]);const i=e.lastRow.number;e.mergeCells(`A${i}:B${i}`),e.getCell(`A${i}`).value=b,e.getCell(`A${i}`).font={bold:!0},e.getCell(`A${i}`).alignment={horizontal:"center"},e.mergeCells(`C${i}:F${i}`),e.getCell(`C${i}`).value="Engr. ABELARDO LUIS D. DE ASIS",e.getCell(`C${i}`).font={bold:!0},e.getCell(`C${i}`).alignment={horizontal:"center"},e.mergeCells(`G${i}:L${i}`),e.getCell(`G${i}`).value="ARNEL M. AGABE, CESO III",e.getCell(`G${i}`).font={bold:!0},e.getCell(`G${i}`).alignment={horizontal:"center"},e.addRow([]);const s=e.lastRow.number;e.mergeCells(`A${s}:B${s}`),e.getCell(`A${s}`).value="Employee",e.getCell(`A${s}`).alignment={horizontal:"center"},e.mergeCells(`C${s}:F${s}`),e.getCell(`C${s}`).value="Immediate Supervisor",e.getCell(`C${s}`).alignment={horizontal:"center"},e.mergeCells(`G${s}:L${s}`),e.getCell(`G${s}`).value="Regional Director",e.getCell(`G${s}`).alignment={horizontal:"center"},e.views=[{state:"frozen",ySplit:o}];const P=`RICTU_Accomplishment_Report_${H(u)}_${h||"ALL"}_${C||"ALL"}.xlsx`,V=await n.xlsx.writeBuffer();re.saveAs(new Blob([V]),P)},H=t=>t&&t!=="all"?t.replace(/\s+/g,"_"):"All",Y=async()=>{if(!h||!C){v($,"Validation","Please choose both From and To dates.");return}if(new Date(h)>new Date(C)){v($,"Validation","From date should be before or equal to To date.");return}N(!0);try{const t=R.filter(n=>{const e=u==="all"||!u?!0:n.it_staff===u;if(!B(n))return!1;const c=n.created_at?new Date(n.created_at):null;if(!c)return!1;const g=new Date(h+"T00:00:00"),b=new Date(C+"T23:59:59");return c<g||c>b?!1:e});t.length===0&&v($,"No data","No finished logs found for the selected filters."),await M(t),v($,"Export ready","Accomplishment Report has been downloaded."),y(!1)}catch(t){console.error(t),v($,"Export failed",t instanceof Error?t.message:"Could not generate Accomplishment Report.")}finally{N(!1)}};return r.jsxs(r.Fragment,{children:[r.jsx("div",{children:r.jsx(S,{onClick:()=>y(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Accomplishment"})}),r.jsx(ae,{open:G,onOpenChange:y,children:r.jsxs(ne,{className:"sm:max-w-md",children:[r.jsx(oe,{children:r.jsx(ie,{children:"Generate Accomplishment Report"})}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(F,{children:"IT Staff"}),r.jsx("select",{value:u,onChange:t=>K(t.target.value),className:"w-full mt-1 p-2 border rounded bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:_.map(t=>r.jsx("option",{value:t,children:t==="all"?"All":t},t))})]}),r.jsxs("div",{children:[r.jsx(F,{children:"From"}),r.jsx("input",{type:"date",value:h,onChange:t=>k(t.target.value),className:"w-full mt-1 p-2 border rounded bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]}),r.jsxs("div",{children:[r.jsx(F,{children:"To"}),r.jsx("input",{type:"date",value:C,onChange:t=>j(t.target.value),className:"w-full mt-1 p-2 border rounded bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]})]}),r.jsxs(se,{children:[r.jsx(S,{onClick:()=>y(!1),className:"mr-2",children:"Cancel"}),r.jsx(S,{disabled:T,onClick:Y,className:"bg-blue-600 hover:bg-blue-700 text-white",children:T?"Generating...":"Generate Accomplishment Report"})]})]})})]})}export{ve as default};
