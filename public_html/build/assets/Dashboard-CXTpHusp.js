import{u as $,r as a,b as q,j as e,H as ke,L as Ee}from"./app-DGf4tkIF.js";import{B as h}from"./button-1e0LvRcT.js";import{A as Te}from"./app-layout-QkWz0ikj.js";import{D as B,a as G,b as E,c as T,d as ne}from"./dialog-CvmmV-Iy.js";import{T as De}from"./textarea-nytJknMs.js";import{L as c}from"./label-dBvvjuKR.js";import{S as x,a as p,b as j,c as b,f as r}from"./select-BZC_PwVz.js";import{s as U,E as Ie,F as _e}from"./notif-Brxvyi7Z.js";import Me from"./ProcessSummaryReport-DC_I9kGa.js";import"./x-CGtyEUrO.js";import"./index-B_gHfJ-f.js";import"./index-C4vgMFgL.js";import"./index-C8_E6Yb5.js";import"./index-D1bwB8Iq.js";import"./createLucideIcon-HDw9yZBM.js";import"./index-k1fbeqpN.js";import"./index-IZwWuCtG.js";import"./app-logo-icon-DbTbV1cS.js";import"./index-YlFGqIY4.js";const Ae=[{title:"Dashboard",href:"/dashboard"}],et=()=>{const{auth:i}=$().props,[J,ie]=a.useState(null),[K,oe]=a.useState(null),{logs:D}=$().props,[u,W]=a.useState(D),de=u?.meta?.current_page??1,ce=u?.meta?.per_page??10,{superadmins:Y=[]}=$().props,[Q,I]=a.useState(!1),[he,C]=a.useState(!1),[X,_]=a.useState(null),[M,v]=a.useState(""),[A,w]=a.useState(""),[me,N]=a.useState(!1),ue=Y.find(l=>String(l.id)===M)?.css_link??"#",[L,fe]=a.useState("all"),[R,ge]=a.useState("all"),[S,xe]=a.useState(""),[y,pe]=a.useState(""),je=L!=="all"||R!=="all"||S!==""||y!=="",Z=u.data.filter(l=>{const t=L==="all"||l.it_staff===L,n=R==="all"||l.status===R,F=new Date(l.finished_date).getTime(),H=!S||F>=new Date(S).setHours(0,0,0,0),le=!y||F<=new Date(y).setHours(23,59,59,999);return t&&n&&H&&le}),[be,O]=a.useState(!1),[ee,Ce]=a.useState("all"),[te,ve]=a.useState("all"),[P,we]=a.useState(""),[z,Ne]=a.useState("");function Se(){const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/deploy-commands-local":"/deploy-commands";fetch(t).then(n=>n.json()).then(n=>{alert(n.message)}).catch(()=>{alert("Deployment failed.")})}const ye=async()=>{const l=new Ie.Workbook,t=l.addWorksheet("TA Monitoring Logsheet");t.columns=[{width:5},{width:25},{width:12},{width:12},{width:20},{width:20},{width:20},{width:25},{width:20},{width:15},{width:15},{width:15},{width:15},{width:20},{width:15}];const n=await fetch("/dilg-logo.png").then(s=>s.blob()).then(s=>new Promise(o=>{const d=new FileReader;d.onload=()=>o(d.result),d.readAsArrayBuffer(s)})),F=l.addImage({buffer:n,extension:"png"});t.addImage(F,{tl:{col:1,row:0},ext:{width:85,height:85}}),t.mergeCells("M1:O1"),t.getCell("M1").value="Document Code",t.getCell("M1").alignment={horizontal:"left",vertical:"middle"},t.getCell("M1").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("M1").font={color:{argb:"FFFFFF"},bold:!0},t.mergeCells("M2:O2"),t.getCell("M2").value="FM-QP-DILG-ISTMS-17-02",t.getCell("M2").alignment={horizontal:"center",vertical:"middle"},t.getCell("M2").font={bold:!0},t.getCell("M3").value="Rev. No.",t.getCell("M3").alignment={horizontal:"center",vertical:"top"},t.getCell("M3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("M3").font={color:{argb:"FFFFFF"},bold:!0},t.getCell("N3").value="Eff. Date",t.getCell("N3").alignment={horizontal:"center",vertical:"top"},t.getCell("N3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("N3").font={color:{argb:"FFFFFF"},bold:!0},t.getCell("O3").value="Page",t.getCell("O3").alignment={horizontal:"center",vertical:"top"},t.getCell("O3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("O3").font={color:{argb:"FFFFFF"},bold:!0},t.mergeCells("C2:G2"),t.getCell("C2").value="Department of the Interior and Local Government",t.getCell("C2").alignment={horizontal:"left",vertical:"middle"},t.getCell("C2").font={size:14},t.getRow(2).height=18,t.mergeCells("C3:H4"),t.getCell("C3").value="ICT Technical Assistance Monitoring Logsheet",t.getCell("C3").alignment={horizontal:"left",vertical:"top"},t.getCell("C3").font={size:23,bold:!0},t.getRow(3).height=25,t.mergeCells("A6:O6"),t.getCell("A6").value="PERIOD:",t.getCell("A6").alignment={horizontal:"left",vertical:"middle"};const H={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};["A6","B6","C6","D6","E6","F6","G6","H6","I6","J6","K6","L6","M6","N6","O6","M2","N2","O2","M4","N4","O4"].forEach(s=>{t.getCell(s).border=H}),t.addRow([]),t.mergeCells("A7:A8"),t.getCell("A7").value="NO.",t.mergeCells("B7:B8"),t.getCell("B7").value="ICT TECHNICAL ASSISTANCE REFERENCE NO.",t.mergeCells("C7:D7"),t.getCell("C7").value="RECEIVED",t.getCell("C8").value="DATE",t.getCell("D8").value="TIME",t.mergeCells("E7:E8"),t.getCell("E7").value="NAME OF THE END-USER",t.mergeCells("F7:G8"),t.getCell("F7").value="OFFICE/SERVICE/BUREAU/DIVISION/SECTION/UNIT",t.getCell("F7").alignment={horizontal:"center",vertical:"middle",wrapText:!0},t.getCell("F7").font={bold:!0},t.mergeCells("H7:H8"),t.getCell("H7").value="ISSUE/CONCERN",t.mergeCells("I7:I8"),t.getCell("I7").value="TECHNICAL PERSONNEL ASSIGNED",t.mergeCells("J7:K7"),t.getCell("J7").value="AGREED TIMELINE (if any)",t.getCell("J8").value="DATE",t.getCell("K8").value="TIME",t.mergeCells("L7:M7"),t.getCell("L7").value="COMPLETED",t.getCell("L8").value="DATE",t.getCell("M8").value="TIME",t.mergeCells("N7:N8"),t.getCell("N7").value="TOTAL PROCESSING TIME",t.mergeCells("O7:O8"),t.getCell("O7").value="OVERALL QUALITY RATING",t.getRow(7).height=30,t.getRow(8).height=25;for(let s=7;s<=8;s++)t.getRow(s).eachCell(o=>{o.font={bold:!0},o.alignment={horizontal:"center",vertical:"middle",wrapText:!0},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});u.data.filter(s=>{const o=ee==="all"||s.it_staff===ee,d=te==="all"||s.status===te,f=new Date(s.created_at);let g=!0;if(P){const m=new Date(P+"T00:00:00");f<m&&(g=!1)}if(z){const m=new Date(z+"T23:59:59");f>m&&(g=!1)}return o&&d&&g}).forEach((s,o)=>{const d=new Date(s.created_at);let f="-";if(s.finished_date&&s.finished_time){const se=new Date(`${s.finished_date} ${s.finished_time}`).getTime()-d.getTime(),ae=Math.floor(se/(1e3*60*60)),re=Math.floor(se%(1e3*60*60)/(1e3*60));f=ae>0?`${ae}hrs ${re}mins`:`${re}mins`}const g=(s.fname??"")+" "+(s.lname??""),m=t.addRow([o+1,`R8-${s.reference_no}`,d.toLocaleDateString(),d.toLocaleTimeString(),g??"-","-",s.sec_div_unit??"-",s.problem_description??"-",s.it_staff??"-",s.agreed_date??"-",s.agreed_time??"-",s.finished_date??"-",s.finished_time??"-",f,"4"]);m.eachCell(V=>{V.alignment={vertical:"middle",horizontal:"center"},V.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});const k=m.number;t.mergeCells(`F${k}:G${k}`),t.getCell(`F${k}`).value=s.sec_div_unit&&s.sec_div_unit!==""?s.sec_div_unit:"-",t.getCell(`F${k}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const Fe=await l.xlsx.writeBuffer();_e.saveAs(new Blob([Fe]),"RICTU_TA-Monitoring-Logsheet.xlsx")};return a.useEffect(()=>{if(i?.user?.role!=="admin"&&i?.user?.role!=="superadmin")return;const l=setInterval(()=>{fetch("/check-new-requests").then(t=>t.json()).then(t=>{const n=t.latest_id;n&&n!==J&&(ie(n),U(i,"New Support Request","A user has submitted a new request."),q.reload({only:["logs"]}))}).catch(()=>{})},1e4);return()=>clearInterval(l)},[J]),a.useEffect(()=>{if(i?.user?.role!=="admin"&&i?.user?.role!=="superadmin")return;const l=setInterval(()=>{fetch("/check-finished-requests").then(t=>t.json()).then(t=>{t.updated_at&&t.updated_at!==K&&(oe(t.updated_at),U(i,"Request Completed","A user has marked a request as finished."),q.reload({only:["logs"]}))}).catch(()=>{})},1e4);return()=>clearInterval(l)},[K]),a.useEffect(()=>{W(D)},[D]),e.jsxs(Te,{breadcrumbs:Ae,children:[e.jsx(ke,{title:"Dashboard"}),e.jsxs("div",{className:"flex m-4 gap-2",children:[e.jsx(h,{asChild:!0,children:e.jsx(Ee,{href:"/support-form",children:"Contact Support"})}),(i?.user?.role==="admin"||i?.user?.role==="superadmin")&&e.jsx(h,{onClick:Se,className:"cursor-pointer",children:"Optimize Routes"})]}),e.jsx(B,{open:Q,onOpenChange:()=>{},children:e.jsxs(G,{className:"flex flex-col items-center justify-center gap-4 py-10",children:[e.jsx(E,{children:e.jsx(T,{})}),e.jsxs("svg",{className:"animate-spin h-8 w-8 text-primary",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Processing your request..."})]})}),e.jsx(B,{open:he,onOpenChange:l=>{l?C(!0):(C(!1),N(!1),_(null),v(""),w(""))},children:e.jsx(G,{className:"sm:max-w-md",children:me?e.jsxs("div",{className:"text-center space-y-4 py-6",children:[e.jsx(E,{className:"flex items-center justify-center text-xl font-semibold",children:e.jsx(T,{children:"Thank you!"})}),e.jsxs("p",{children:["Thanks for completing the request. Please complete answering the",e.jsx("b",{children:" Client Satisfaction Measure System"})," as part of our report. We appreciate your feedback!"]}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("a",{href:ue,target:"_blank",rel:"noopener noreferrer",className:"inline-block px-4 py-2 rounded-md border bg-blue-600 text-white",children:"Go to CSMS Form"}),e.jsx(h,{variant:"outline",onClick:()=>{N(!1),C(!1),v("")},children:"Close"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{children:e.jsx(T,{children:"Update Status"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"it_staff",children:"Select IT Staff"}),e.jsxs(x,{value:M,onValueChange:v,children:[e.jsx(p,{id:"it_staff",children:e.jsx(j,{placeholder:"Select IT Staff"})}),e.jsx(b,{children:Y.map(l=>e.jsxs(r,{value:String(l.id),children:[l.fname," ",l.lname]},l.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"remarks",children:"Remarks"}),e.jsx(De,{id:"remarks",placeholder:"Enter remarks...",value:A,onChange:l=>w(l.target.value)})]})]}),e.jsx(ne,{children:e.jsx(h,{disabled:Q,onClick:()=>{if(!X)return;const l=X;I(!0),q.put(`/tarf-logs/${l}/status`,{status:"finished",it_staff:M,remarks:A},{onSuccess:()=>{I(!1),W(t=>({...t,data:t.data.map(n=>n.id===l?{...n,status:"finished",remarks:A,finished_date:new Date().toISOString().split("T")[0],finished_time:new Date().toLocaleTimeString()}:n)})),N(!0),_(null),w("")},onError:()=>{I(!1),U(i,"Update failed","Could not update status. Try again.")}})},children:"Submit"})})]})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex flex-3 flex-wrap justify-start gap-10",children:[e.jsx("div",{className:"flex items-end mb-1",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Support Requests"})}),e.jsxs("div",{className:"flex flex-3 flex-wrap justify-start gap-2",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Filter by IT Staff"}),e.jsxs(x,{onValueChange:l=>fe(l),defaultValue:"all",children:[e.jsx(p,{className:"w-[180px] dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(j,{placeholder:"All Staff"})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"All"}),e.jsx(r,{value:"AJ",children:"AJ"}),e.jsx(r,{value:"Chok",children:"Chok"}),e.jsx(r,{value:"Kenot",children:"Kenot"}),e.jsx(r,{value:"Emman",children:"Emman"}),e.jsx(r,{value:"Real",children:"Real"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Filter by Status"}),e.jsxs(x,{onValueChange:l=>ge(l),defaultValue:"all",children:[e.jsx(p,{className:"w-[180px] dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(j,{placeholder:"All Status"})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"All"}),e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"finished",children:"Finished"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Filter by Date (From - To)"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"date",className:"w-1/2 dark:bg-gray-800 dark:border-gray-600 dark:text-white border rounded px-2 py-[5px]",value:S,onChange:l=>xe(l.target.value)}),e.jsx("input",{type:"date",className:"w-1/2 dark:bg-gray-800 dark:border-gray-600 dark:text-white border rounded px-2 py-[5px]",value:y,onChange:l=>pe(l.target.value)})]})]})]})]}),e.jsx("div",{className:"flex flex-2 flex-wrap items-end gap-2 justify-end",children:(i?.user?.role==="admin"||i?.user?.role==="superadmin")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center items-center gap-3",children:e.jsx("div",{children:e.jsx(h,{onClick:()=>O(!0),className:"bg-blue-600 hover:bg-blue-700 text-white mt-0 md:mt-5 cursor-pointer",children:"Monitoring Logsheett"})})}),e.jsx(Me,{})]})})]}),e.jsx("div",{className:"overflow-x-auto border rounded-lg mb-4",children:e.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border",children:"No."}),e.jsx("th",{className:"p-3 border",children:"Sender"}),e.jsx("th",{className:"p-3 border",children:"Request Type"}),e.jsx("th",{className:"p-3 border",children:"Problem Description"}),e.jsx("th",{className:"p-3 border",children:"Uploaded File"}),e.jsx("th",{className:"p-3 border",children:"Request Date"}),e.jsx("th",{className:"p-3 border",children:"IT Staff"}),e.jsx("th",{className:"p-3 border",children:"Finished Date"}),e.jsx("th",{className:"p-3 border",children:"Remarks"}),e.jsx("th",{className:"p-3 border",children:"Action"})]})}),e.jsx("tbody",{children:Z.map((l,t)=>e.jsxs("tr",{className:"hover:bg-gray-100 dark:hover:bg-gray-500",children:[e.jsx("td",{className:"p-3 border",children:(de-1)*ce+t+1}),e.jsx("td",{className:"p-3 border",children:l.fname+" "+l.lname}),e.jsx("td",{className:"p-3 border",children:l.request_type_name}),e.jsx("td",{className:"p-3 border",children:l.problem_description||"-"}),e.jsx("td",{className:"p-3 border",children:l.uploaded_file?e.jsx("a",{href:`/storage/${l.uploaded_file}`,target:"_blank",className:"text-blue-600 underline",children:"View File"}):"-"}),e.jsx("td",{className:"p-3 border",children:new Date(l.created_at).toLocaleString()}),e.jsx("td",{className:"p-3 border",children:l.it_staff||"-"}),e.jsx("td",{className:"p-3 border",children:(l.finished_date??"-")+" "+(l.finished_time??"-")}),e.jsx("td",{className:"p-3 border",children:l.remarks??"-"}),e.jsx("td",{className:"p-3 border",children:l.status==="pending"?e.jsx(h,{size:"sm",className:"bg-orange-300 hover:bg-orange-400",onClick:()=>{_(l.id),v(l.it_staff||""),w(l.remarks||""),C(!0),N(!1)},children:"Update Status"}):e.jsx("span",{className:"text-green-700 font-semibold text-sm",children:"✔Finished"})})]},l.id))})]})}),je?e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Showing ",Z.length," result(s) — pagination is disabled while filters are active."]}):e.jsx("div",{className:"flex justify-center mt-4",children:u.links.map((l,t)=>e.jsx("button",{disabled:!l.url,className:`px-3 py-1 mx-1 rounded border ${l.active?"bg-blue-600 text-white":"bg-white text-gray-700"}`,dangerouslySetInnerHTML:{__html:l.label},onClick:()=>{l.url&&(window.location.href=l.url)}},t))})]}),e.jsx(B,{open:be,onOpenChange:O,children:e.jsxs(G,{className:"sm:max-w-md",children:[e.jsx(E,{children:e.jsx(T,{children:"Download Monitoring Logsheet"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Filter by IT Staff"}),e.jsxs(x,{onValueChange:Ce,defaultValue:"all",children:[e.jsx(p,{className:"bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(j,{placeholder:"All Staff"})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"All"}),e.jsx(r,{value:"AJ",children:"AJ"}),e.jsx(r,{value:"Chok",children:"Chok"}),e.jsx(r,{value:"Kenot",children:"Kenot"}),e.jsx(r,{value:"Emman",children:"Emman"}),e.jsx(r,{value:"Real",children:"Real"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Filter by Status"}),e.jsxs(x,{onValueChange:ve,defaultValue:"all",children:[e.jsx(p,{className:"bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(j,{placeholder:"All Status"})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"All"}),e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"finished",children:"Finished"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Date From"}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:P,onChange:l=>we(l.target.value)})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Date To"}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2 bg-white dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:z,onChange:l=>Ne(l.target.value)})]})]}),e.jsx(ne,{children:e.jsx(h,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{O(!1),ye()},children:"Download Logsheet"})})]})})]})};export{et as default};
