import{K as Q,r,S as R,j as e,L as ve,$ as be}from"./app-JePiJmW7.js";import{B as h}from"./button-BYPSRbUn.js";import{A as Ne}from"./app-layout-BmhTX0NJ.js";import{D as O,a as z,b as X,c as Z,d as ee}from"./dialog-DD_oNLaa.js";import{T as we}from"./textarea-D0WWcqpy.js";import{L as c}from"./label-DijklJDp.js";import{S as g,a as p,b as j,c as C,f as a}from"./select-BeJwtUWG.js";import{s as P,E as Se,F as ye}from"./notif-DXj-O9Yw.js";import Ee from"./ProcessSummaryReport-DRsgrGi2.js";import"./x-CH8BbwtT.js";import"./index-C3bKHVhT.js";import"./index-D9n2Vnak.js";import"./index-D8kDeknw.js";import"./index-DwHGk1i-.js";import"./createLucideIcon-44Xvmft_.js";import"./index-XZLv5LLu.js";import"./index-BkBenCew.js";import"./app-logo-icon-BNNDWRka.js";import"./index-wVDNK0RW.js";const Fe=[{title:"Dashboard",href:"/dashboard"}],Te={AJ:"https://ecsm.dilg.gov.ph/?survey=tsj0jhw0q",Chok:"https://ecsm.dilg.gov.ph/?survey=863vrwt84",Kenot:"https://ecsm.dilg.gov.ph/?survey=863vrwt84",Emman:"https://ecsm.dilg.gov.ph/?survey=jo4vvug37",Real:"https://ecsm.dilg.gov.ph/?survey=6l9f0s149"},We=()=>{const{auth:i}=Q().props,[V,te]=r.useState(null),[$,le]=r.useState(null),{logs:y}=Q().props,[u,q]=r.useState(y),se=u?.meta?.current_page??1,ae=u?.meta?.per_page??10,[J,E]=r.useState(!1),[re,v]=r.useState(!1),[K,F]=r.useState(null),[T,b]=r.useState(""),[I,N]=r.useState(""),[ne,w]=r.useState(!1),[_,ie]=r.useState("all"),[A,oe]=r.useState("all"),de=_!=="all"||A!=="all",U=u.data.filter(l=>{const t=_==="all"||l.it_staff===_,n=A==="all"||l.status===A;return t&&n}),[ce,M]=r.useState(!1),[B,he]=r.useState("all"),[G,me]=r.useState("all"),[k,ue]=r.useState(""),[D,fe]=r.useState("");function xe(){const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/deploy-commands-local":"/deploy-commands";fetch(t).then(n=>n.json()).then(n=>{alert(n.message)}).catch(()=>{alert("Deployment failed.")})}const ge=async()=>{const l=new Se.Workbook,t=l.addWorksheet("TA Monitoring Logsheet");t.columns=[{width:5},{width:25},{width:12},{width:12},{width:20},{width:20},{width:20},{width:25},{width:20},{width:15},{width:15},{width:15},{width:15},{width:20},{width:15}];const n=await fetch("/dilg-logo.png").then(s=>s.blob()).then(s=>new Promise(o=>{const d=new FileReader;d.onload=()=>o(d.result),d.readAsArrayBuffer(s)})),pe=l.addImage({buffer:n,extension:"png"});t.addImage(pe,{tl:{col:1,row:0},ext:{width:85,height:85}}),t.mergeCells("M1:O1"),t.getCell("M1").value="Document Code",t.getCell("M1").alignment={horizontal:"left",vertical:"middle"},t.getCell("M1").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("M1").font={color:{argb:"FFFFFF"},bold:!0},t.mergeCells("M2:O2"),t.getCell("M2").value="FM-QP-DILG-ISTMS-17-02",t.getCell("M2").alignment={horizontal:"center",vertical:"middle"},t.getCell("M2").font={bold:!0},t.getCell("M3").value="Rev. No.",t.getCell("M3").alignment={horizontal:"center",vertical:"top"},t.getCell("M3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("M3").font={color:{argb:"FFFFFF"},bold:!0},t.getCell("N3").value="Eff. Date",t.getCell("N3").alignment={horizontal:"center",vertical:"top"},t.getCell("N3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("N3").font={color:{argb:"FFFFFF"},bold:!0},t.getCell("O3").value="Page",t.getCell("O3").alignment={horizontal:"center",vertical:"top"},t.getCell("O3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"000000"}},t.getCell("O3").font={color:{argb:"FFFFFF"},bold:!0},t.mergeCells("C2:G2"),t.getCell("C2").value="Department of the Interior and Local Government",t.getCell("C2").alignment={horizontal:"left",vertical:"middle"},t.getCell("C2").font={size:14},t.getRow(2).height=18,t.mergeCells("C3:H4"),t.getCell("C3").value="ICT Technical Assistance Monitoring Logsheet",t.getCell("C3").alignment={horizontal:"left",vertical:"top"},t.getCell("C3").font={size:23,bold:!0},t.getRow(3).height=25,t.mergeCells("A6:O6"),t.getCell("A6").value="PERIOD:",t.getCell("A6").alignment={horizontal:"left",vertical:"middle"};const je={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};["A6","B6","C6","D6","E6","F6","G6","H6","I6","J6","K6","L6","M6","N6","O6","M2","N2","O2","M4","N4","O4"].forEach(s=>{t.getCell(s).border=je}),t.addRow([]),t.mergeCells("A7:A8"),t.getCell("A7").value="NO.",t.mergeCells("B7:B8"),t.getCell("B7").value="ICT TECHNICAL ASSISTANCE REFERENCE NO.",t.mergeCells("C7:D7"),t.getCell("C7").value="RECEIVED",t.getCell("C8").value="DATE",t.getCell("D8").value="TIME",t.mergeCells("E7:E8"),t.getCell("E7").value="NAME OF THE END-USER",t.mergeCells("F7:G8"),t.getCell("F7").value="OFFICE/SERVICE/BUREAU/DIVISION/SECTION/UNIT",t.getCell("F7").alignment={horizontal:"center",vertical:"middle",wrapText:!0},t.getCell("F7").font={bold:!0},t.mergeCells("H7:H8"),t.getCell("H7").value="ISSUE/CONCERN",t.mergeCells("I7:I8"),t.getCell("I7").value="TECHNICAL PERSONNEL ASSIGNED",t.mergeCells("J7:K7"),t.getCell("J7").value="AGREED TIMELINE (if any)",t.getCell("J8").value="DATE",t.getCell("K8").value="TIME",t.mergeCells("L7:M7"),t.getCell("L7").value="COMPLETED",t.getCell("L8").value="DATE",t.getCell("M8").value="TIME",t.mergeCells("N7:N8"),t.getCell("N7").value="TOTAL PROCESSING TIME",t.mergeCells("O7:O8"),t.getCell("O7").value="OVERALL QUALITY RATING",t.getRow(7).height=30,t.getRow(8).height=25;for(let s=7;s<=8;s++)t.getRow(s).eachCell(o=>{o.font={bold:!0},o.alignment={horizontal:"center",vertical:"middle",wrapText:!0},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});u.data.filter(s=>{const o=B==="all"||s.it_staff===B,d=G==="all"||s.status===G,f=new Date(s.created_at);let x=!0;if(k){const m=new Date(k+"T00:00:00");f<m&&(x=!1)}if(D){const m=new Date(D+"T23:59:59");f>m&&(x=!1)}return o&&d&&x}).forEach((s,o)=>{const d=new Date(s.created_at);let f="-";if(s.finished_date&&s.finished_time){const H=new Date(`${s.finished_date} ${s.finished_time}`).getTime()-d.getTime(),W=Math.floor(H/(1e3*60*60)),Y=Math.floor(H%(1e3*60*60)/(1e3*60));f=W>0?`${W}hrs ${Y}mins`:`${Y}mins`}const x=(s.fname??"")+" "+(s.lname??""),m=t.addRow([o+1,`R8-${s.reference_no}`,d.toLocaleDateString(),d.toLocaleTimeString(),x??"-","-",s.sec_div_unit??"-",s.problem_description??"-",s.it_staff??"-",s.agreed_date??"-",s.agreed_time??"-",s.finished_date??"-",s.finished_time??"-",f,"4"]);m.eachCell(L=>{L.alignment={vertical:"middle",horizontal:"center"},L.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});const S=m.number;t.mergeCells(`F${S}:G${S}`),t.getCell(`F${S}`).value=s.sec_div_unit&&s.sec_div_unit!==""?s.sec_div_unit:"-",t.getCell(`F${S}`).alignment={horizontal:"center",vertical:"middle",wrapText:!0}});const Ce=await l.xlsx.writeBuffer();ye.saveAs(new Blob([Ce]),"RICTU_TA-Monitoring-Logsheet.xlsx")};return r.useEffect(()=>{if(i?.user?.role!=="admin"&&i?.user?.role!=="superadmin")return;const l=setInterval(()=>{fetch("/check-new-requests").then(t=>t.json()).then(t=>{const n=t.latest_id;n&&n!==V&&(te(n),P(i,"New Support Request","A user has submitted a new request."),R.reload({only:["logs"]}))}).catch(()=>{})},1e4);return()=>clearInterval(l)},[V]),r.useEffect(()=>{if(i?.user?.role!=="admin"&&i?.user?.role!=="superadmin")return;const l=setInterval(()=>{fetch("/check-finished-requests").then(t=>t.json()).then(t=>{t.updated_at&&t.updated_at!==$&&(le(t.updated_at),P(i,"Request Completed","A user has marked a request as finished."),R.reload({only:["logs"]}))}).catch(()=>{})},1e4);return()=>clearInterval(l)},[$]),r.useEffect(()=>{q(y)},[y]),e.jsxs(Ne,{breadcrumbs:Fe,children:[e.jsx(ve,{title:"Dashboard"}),e.jsxs("div",{className:"flex m-4 gap-2",children:[e.jsx(h,{asChild:!0,children:e.jsx(be,{href:"/support-form",children:"Contact Support"})}),(i?.user?.role==="admin"||i?.user?.role==="superadmin")&&e.jsx(h,{onClick:xe,className:"cursor-pointer",children:"Optimize Routes"})]}),e.jsx(O,{open:J,onOpenChange:()=>{},children:e.jsxs(z,{className:"flex flex-col items-center justify-center gap-4 py-10",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-primary",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Processing your request..."})]})}),e.jsx(O,{open:re,onOpenChange:l=>{l?v(!0):(v(!1),w(!1),F(null),b(""),N(""))},children:e.jsx(z,{className:"sm:max-w-md",children:ne?e.jsxs("div",{className:"text-center space-y-4 py-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Thank you!"}),e.jsxs("p",{children:["Thanks for completing the request. Please complete answering the",e.jsx("b",{children:" Client Satisfaction Measure System"})," as part of our report. We appreciate your feedback!"]}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("a",{href:Te[T]??"#",target:"_blank",rel:"noopener noreferrer",className:"inline-block px-4 py-2 rounded-md border bg-blue-600 text-white",children:"Go to CSMS Form"}),e.jsx(h,{variant:"outline",onClick:()=>{w(!1),v(!1),b("")},children:"Close"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsx(Z,{children:"Update Status"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"it_staff",children:"Select IT Staff"}),e.jsxs(g,{onValueChange:l=>b(l),value:T,children:[e.jsx(p,{id:"it_staff",children:e.jsx(j,{placeholder:"Select IT Staff"})}),e.jsxs(C,{children:[e.jsx(a,{value:"AJ",children:"AJ"}),e.jsx(a,{value:"Chok",children:"Chok"}),e.jsx(a,{value:"Kenot",children:"Kenot"}),e.jsx(a,{value:"Emman",children:"Emman"}),e.jsx(a,{value:"Real",children:"Real"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"remarks",children:"Remarks"}),e.jsx(we,{id:"remarks",placeholder:"Enter remarks...",value:I,onChange:l=>N(l.target.value)})]})]}),e.jsx(ee,{children:e.jsx(h,{disabled:J,onClick:()=>{if(!K)return;const l=K;E(!0),R.put(`/tarf-logs/${l}/status`,{status:"finished",it_staff:T,remarks:I},{onSuccess:()=>{E(!1),q(t=>({...t,data:t.data.map(n=>n.id===l?{...n,status:"finished",remarks:I,finished_date:new Date().toISOString().split("T")[0],finished_time:new Date().toLocaleTimeString()}:n)})),w(!0),F(null),N("")},onError:()=>{E(!1),P(i,"Update failed","Could not update status. Try again.")}})},children:"Submit"})})]})})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex flex-3 flex-wrap justify-start gap-10",children:[e.jsx("div",{className:"flex items-end mb-1",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Support Requests"})}),e.jsxs("div",{className:"flex flex-3 flex-wrap justify-start gap-2",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Filter by IT Staff"}),e.jsxs(g,{onValueChange:l=>ie(l),defaultValue:"all",children:[e.jsx(p,{className:"w-[180px] dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(j,{placeholder:"All Staff"})}),e.jsxs(C,{children:[e.jsx(a,{value:"all",children:"All"}),e.jsx(a,{value:"AJ",children:"AJ"}),e.jsx(a,{value:"Chok",children:"Chok"}),e.jsx(a,{value:"Kenot",children:"Kenot"}),e.jsx(a,{value:"Emman",children:"Emman"}),e.jsx(a,{value:"Real",children:"Real"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Filter by Status"}),e.jsxs(g,{onValueChange:l=>oe(l),defaultValue:"all",children:[e.jsx(p,{className:"w-[180px] dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:e.jsx(j,{placeholder:"All Status"})}),e.jsxs(C,{children:[e.jsx(a,{value:"all",children:"All"}),e.jsx(a,{value:"pending",children:"Pending"}),e.jsx(a,{value:"finished",children:"Finished"})]})]})]})]})]}),e.jsx("div",{className:"flex flex-1 flex-wrap items-end gap-2 justify-end",children:(i?.user?.role==="admin"||i?.user?.role==="superadmin")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center items-center gap-3",children:e.jsx("div",{children:e.jsx(h,{onClick:()=>M(!0),className:"bg-blue-600 hover:bg-blue-700 text-white mt-0 md:mt-5 cursor-pointer",children:"Monitoring Logsheett"})})}),e.jsx(Ee,{})]})})]}),e.jsx("div",{className:"overflow-x-auto border rounded-lg mb-4",children:e.jsxs("table",{className:"w-full table-auto border-collapse text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border",children:"No."}),e.jsx("th",{className:"p-3 border",children:"Sender"}),e.jsx("th",{className:"p-3 border",children:"Request Type"}),e.jsx("th",{className:"p-3 border",children:"Problem Description"}),e.jsx("th",{className:"p-3 border",children:"Uploaded File"}),e.jsx("th",{className:"p-3 border",children:"Request Date"}),e.jsx("th",{className:"p-3 border",children:"IT Staff"}),e.jsx("th",{className:"p-3 border",children:"Finished Date"}),e.jsx("th",{className:"p-3 border",children:"Remarks"}),e.jsx("th",{className:"p-3 border",children:"Action"})]})}),e.jsx("tbody",{children:U.map((l,t)=>e.jsxs("tr",{className:"hover:bg-gray-100 dark:hover:bg-gray-500",children:[e.jsx("td",{className:"p-3 border",children:(se-1)*ae+t+1}),e.jsx("td",{className:"p-3 border",children:l.fname+" "+l.lname}),e.jsx("td",{className:"p-3 border",children:l.request_type_name}),e.jsx("td",{className:"p-3 border",children:l.problem_description||"-"}),e.jsx("td",{className:"p-3 border",children:l.uploaded_file?e.jsx("a",{href:`/storage/${l.uploaded_file}`,target:"_blank",className:"text-blue-600 underline",children:"View File"}):"-"}),e.jsx("td",{className:"p-3 border",children:new Date(l.created_at).toLocaleString()}),e.jsx("td",{className:"p-3 border",children:l.it_staff||"-"}),e.jsx("td",{className:"p-3 border",children:(l.finished_date??"-")+" "+(l.finished_time??"-")}),e.jsx("td",{className:"p-3 border",children:l.remarks??"-"}),e.jsx("td",{className:"p-3 border",children:l.status==="pending"?e.jsx(h,{size:"sm",className:"bg-orange-300 hover:bg-orange-400",onClick:()=>{F(l.id),b(l.it_staff||""),N(l.remarks||""),v(!0),w(!1)},children:"Update Status"}):e.jsx("span",{className:"text-green-700 font-semibold text-sm",children:"✔Finished"})})]},l.id))})]})}),de?e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Showing ",U.length," result(s) — pagination is disabled while filters are active."]}):e.jsx("div",{className:"flex justify-center mt-4",children:u.links.map((l,t)=>e.jsx("button",{disabled:!l.url,className:`px-3 py-1 mx-1 rounded border ${l.active?"bg-blue-600 text-white":"bg-white text-gray-700"}`,dangerouslySetInnerHTML:{__html:l.label},onClick:()=>{l.url&&(window.location.href=l.url)}},t))})]}),e.jsx(O,{open:ce,onOpenChange:M,children:e.jsxs(z,{className:"sm:max-w-md",children:[e.jsx(X,{children:e.jsx(Z,{children:"Download Monitoring Logsheet"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Filter by IT Staff"}),e.jsxs(g,{onValueChange:he,defaultValue:"all",children:[e.jsx(p,{children:e.jsx(j,{placeholder:"All Staff"})}),e.jsxs(C,{children:[e.jsx(a,{value:"all",children:"All"}),e.jsx(a,{value:"AJ",children:"AJ"}),e.jsx(a,{value:"Chok",children:"Chok"}),e.jsx(a,{value:"Kenot",children:"Kenot"}),e.jsx(a,{value:"Emman",children:"Emman"}),e.jsx(a,{value:"Real",children:"Real"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Filter by Status"}),e.jsxs(g,{onValueChange:me,defaultValue:"all",children:[e.jsx(p,{children:e.jsx(j,{placeholder:"All Status"})}),e.jsxs(C,{children:[e.jsx(a,{value:"all",children:"All"}),e.jsx(a,{value:"pending",children:"Pending"}),e.jsx(a,{value:"finished",children:"Finished"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Date From"}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",value:k,onChange:l=>ue(l.target.value)})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Date To"}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",value:D,onChange:l=>fe(l.target.value)})]})]}),e.jsx(ee,{children:e.jsx(h,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{M(!1),ge()},children:"Download Logsheet"})})]})})]})};export{We as default};
